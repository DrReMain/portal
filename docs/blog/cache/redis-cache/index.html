<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="zeromicro">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="https://go-zero.dev/favicon.png">
<link rel="icon" href="https://go-zero.dev/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="https://go-zero.dev/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="go-zero Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="go-zero Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZD0YKV3XQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XZD0YKV3XQ",{anonymize_ip:!0})</script>
<link rel="manifest" href="//manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c"><title data-react-helmet="true">go-zero cache design for persistence layer cache | go-zero</title><meta data-react-helmet="true" property="og:image" content><meta data-react-helmet="true" name="twitter:image" content><meta data-react-helmet="true" name="twitter:description" content="go-zero 是一个集成了各种工程实践的 web 和 rpc 框架。通过弹性设计保障了大并发服务端的稳定性，经受了充分的实战检验。"><meta data-react-helmet="true" name="twitter:title" content="Introduction | go-zero"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Introduction | go-zero&quot;"><meta data-react-helmet="true" property="og:title" content="go-zero cache design for persistence layer cache | go-zero"><meta data-react-helmet="true" name="description" content="Cache design principles"><meta data-react-helmet="true" property="og:description" content="Cache design principles"><link rel="stylesheet" href="/assets/css/styles.3acd5940.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="">
<meta itemprop="description" content="go-zero 是一个集成了各种工程实践的 web 和 rpc 框架。通过弹性设计保障了大并发服务端的稳定性，经受了充分的实战检验。">
<meta itemprop="url" content="https://go-zero.dev">
<meta itemprop="logo" content="https://go-zero.dev/img/favicon.png">
<meta itemprop="sameAs" content="https://github.com/zeromicro">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light navbar--fixed-top"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="brand_AtiA" href="/"><img alt="logo" height="30" src="/img/navbar/logo.svg" class="brand_logo_MqNk"><a class="navbar__brand brand_name_O39n">go-zero</a></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/prepare/prepare">Preparation</a></li><li><a class="dropdown__link" href="/docs/quick-start/quick-start">Getting Started</a></li><li><a class="dropdown__link" href="/docs/component/components">Components</a></li><li><a class="dropdown__link" href="/docs/advance/advance">Guides</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" sidebarid="goctl">goctl</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/goctl/goctl">Installation</a></li><li><a class="dropdown__link" href="/docs/goctl/api">API Command</a></li><li><a class="dropdown__link" href="/docs/goctl/zrpc">RPC Command</a></li><li><a class="dropdown__link" href="/docs/goctl/model">Model Command</a></li><li><a class="dropdown__link" href="/docs/goctl/completion">Completion</a></li><li><a class="dropdown__link" href="/docs/goctl/tutorial/tutorial">Tutorial</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Eco</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/eco/plugins">Goctl Plugin</a></li><li><a class="dropdown__link" href="/docs/eco/editor">Editor Plugin</a></li><li><a class="dropdown__link" href="/docs/eco/distributed-transaction">Distributed Transaction (DTM)</a></li><li><a class="dropdown__link" href="/docs/eco/showcase">Showcase</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/community/about-us">About us</a></li><li><a class="dropdown__link" href="/docs/community/contribute">Contributing</a></li><li><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub</a></li><li><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord</a></li></ul></div><a class="navbar__item navbar__link" sidebarid="blog" href="/docs/blog/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">More</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/resource-center/learning-resource">Resource Center</a></li><li><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="dropdown__link">Video Tutorial</a></li><li><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="dropdown__link">Development Roadmap</a></li><li><a class="dropdown__link" href="/docs/design/design">Design Docs</a></li><li><a class="dropdown__link" href="/docs/faq/troubleshooting">FAQ</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="searchWrapper_glLF"><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg t="1651714104711" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8547" width="24" height="24" style="vertical-align:text-bottom;margin-right:5px"><path d="M0 0h1024v1024H0z" fill="#FFFFFF" p-id="8548"></path><path d="M785.09056 297.86112l-0.01024-176.40448-253.61408 87.18336 253.62432 89.22112zM499.3024 197.64224L232.58112 102.4v184.1664l266.72128-88.92416zM334.1824 337.37728l44.46208-12.70784v53.97504l95.26272-34.9184v171.4688l-38.11328 12.6976v-25.38496l-63.50848 25.38496 0.27648 95.41632-38.37952 12.55424-0.28672-94.44352-63.21152 24.576 0.01024 19.05664-38.12352 12.6976 0.01024-171.45856 101.60128-31.75424v-57.15968z m101.61152 60.33408l-57.14944 22.2208v63.50848l57.14944-19.05664v-66.67264zM270.68416 521.54368l63.50848-22.23104-0.01024-66.67264-63.49824 22.2208v66.68288z m247.67488-308.40832l-342.9376 117.88288v469.9648l342.9376-114.3296V213.13536z m9.55392 489.41056c-123.38176 41.30816-248.24832 82.5344-371.54816 123.83232l-0.01024-508.0576L804.1472 102.4v202.16832l63.50848 20.10112-0.01024 489.0112-339.73248-111.13472z m266.6496-20.1728c-14.92992-53.98528-29.9008-108.19584-44.9024-162.54976-15.0528-54.49728-30.11584-109.24032-45.2608-164.15744-16.22016-6.28736-32.48128-12.60544-48.81408-18.944-14.85824 43.61216-29.76768 87.36768-44.6976 131.21536l-45.056 132.28032c16.57856 5.96992 33.16736 11.9296 49.68448 17.85856 6.4-20.1728 12.8-40.36608 19.18976-60.54912 30.49472 11.1616 60.9792 22.3232 91.46368 33.47456 6.5024 24.65792 12.99456 49.28512 19.51744 73.8304 16.32256 5.86752 32.63488 11.70432 48.87552 17.54112zM711.30112 535.8592c-10.5472-40.2944-21.10464-80.59904-31.58016-120.90368-10.31168 32.5632-20.60288 65.14688-30.90432 97.73056 20.8384 7.71072 41.65632 15.45216 62.48448 23.17312z m-30.53568 312.10496c-121.21088 75.776-241.60256 85.18656-365.38368 6.51264l-6.62528 10.35264c118.45632 75.264 236.3392 74.07616 357.65248 6.01088 7.10656-4.03456 14.08-8.192 20.992-12.51328L701.44 880.25088l31.87712-58.5728-66.53952 4.42368 13.98784 21.8624z" p-id="8549"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/blog/cache/redis-cache" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/cn/docs/blog/cache/redis-cache" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">中文简体</a></li></ul></div><a href="https://github.com/zeromicro/go-zero" class="navbar__items navbar__items--right"><img alt="forks" height="30" src="/img/navbar/github-dark.svg" class="star__fork_dBtt"><div class="star_fork_layout_ROo5"><img alt="stars" height="20" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="star__fork_dBtt"><img alt="forks" height="20" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="star__fork_dBtt"></div></a><div class="react-toggle themeToggleInHeading_b3Mq react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_1y7K" style="margin-left:2px"><svg t="1651718448922" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2080" width="200" height="200"><path d="M439.04383639 224.33271976a289.43717504 289.43717504 0 0 0-89.06329676 39.44690807c-27.5075319 18.12412161-51.158867 39.64960558-70.96389486 64.57645191-19.79019562 24.92684633-35.31880082 53.25011237-46.62042137 84.97474006C221.10449032 445.05050411 215.45368042 478.01109252 215.45368042 512c0 40.16870887 7.81621301 78.48347702 23.45358166 115.04318192 15.64725682 36.67341315 36.77228986 68.19039996 63.2910532 94.76354538 26.53359488 26.56820206 58.11485196 47.57952611 94.69927585 63.23667111 36.59431134 15.65714501 75.00301286 23.48324474 115.16183354 23.48324475 33.97407594 0 66.85061917-5.56182137 98.62468557-16.89310498 31.76417894-11.32633953 60.10227581-26.77584294 85.01429133-46.65502781 24.87740834-19.77536407 46.43255539-43.46625042 64.57150781-70.96389488a290.15403174 290.15403174 0 0 0 39.43701989-88.98913905c-8.3056532 0.72180079-17.71378249 1.13213991-28.0958481 1.1321392-45.21637032 0-88.35138342-8.85936294-129.45942212-26.46932463-41.1327577-17.71872658-76.62459295-41.50848964-106.44089858-71.27535655C505.84007277 458.54719011 482.10963587 423.01086095 464.42057238 381.91765379 446.7562286 340.81455917 437.94135957 297.65977044 437.94135957 252.4483442c0-10.40184195 0.39550758-19.77536407 1.15685891-28.01674772l-0.049438-0.09887672zM512.02976157 141.21192041c8.32542811 0 16.51242896 0.31146168 24.6054972 0.92944167-16.4036648 35.32374419-24.60549719 72.09603405-24.60549719 110.30698212 0 35.12104668 6.84227598 68.69961578 20.58121076 100.83458258 13.70927096 32.03114601 32.15474243 59.63261126 55.35124448 82.80933769 23.16683898 23.17178306 50.76830423 41.60736635 82.82416923 55.30674985 32.02125855 13.69938351 65.654209 20.60098567 100.78514387 20.60098568 38.23072298 0 75.03267594-8.24138293 110.35147675-24.62032874 0.59326099 8.14250622 0.86517214 16.28006837 0.86517213 24.62032874 0 33.57856837-4.43956893 66.43533597-13.29893256 98.46648269-8.90880166 32.03114601-21.28817928 61.69419283-37.24195443 88.78149743-15.92411206 27.19112615-35.31880082 52.11797247-58.09013296 74.87941716-22.77627549 22.76144395-47.74267309 42.12152555-74.87447306 58.09013223-27.15157487 15.96366261-56.75529553 28.32326532-88.78644152 37.28644905A368.16784419 368.16784419 0 0 1 512.00009921 882.78807959a368.20739474 368.20739474 0 0 1-98.48625832-13.28904439c-32.03609009-8.95824037-61.6249792-21.31784236-88.79138561-37.28150569-27.12685589-15.96860669-52.08336529-35.32868827-74.89919206-58.09013223-22.7515565-22.76144395-42.13635709-47.68829101-58.05058169-74.87941715-15.96366261-27.0922487-28.34304097-56.75529553-37.2518426-88.78149744A367.9354836 367.9354836 0 0 1 141.21201889 512c0-33.57856837 4.4494571-66.43533597 13.30882004-98.46648269 8.90880166-32.03114601 21.28817928-61.69419283 37.25184259-88.78149744 15.91916798-27.19112615 35.29902519-52.11797247 58.0505817-74.87941715 22.81582676-22.86526476 47.77233617-42.22534634 74.89919206-58.09013223C351.89380578 175.81880789 381.4826949 163.36032846 413.51878498 154.50096479A368.20739474 368.20739474 0 0 1 512.00009921 141.21192041h0.02966236z" p-id="2081" fill="#ffffff"></path></svg></span></div><div class="react-toggle-track-x"><span class="toggle_1y7K" style="margin-left:1px"><svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1940" width="25" height="25"><path d="M752.41931153 240.7063601c8.36993432 0 15.62255883 3.08990502 21.72821045 9.16589356 6.1353147 6.08093262 9.18566918 13.3928833 9.18566918 21.73315382 0 8.55285621-3.05035376 15.85986352-9.18566918 21.94079614l-43.67394996 43.66900658c-5.93261719 5.97216773-13.17041016 8.95825195-21.72326709 8.95825195-8.87420678 0-16.20098901-2.98608422-22.08911085-8.75061035-5.88317847-5.87329102-8.80004906-13.2890625-8.80004906-22.14843774 0-8.54791283 2.95642114-15.75604272 8.91375732-21.72821044l43.66900659-43.67394996c6.14025879-6.07598853 13.44726539-9.16589356 21.98034668-9.16589356z m37.66223167 240.39459181h61.79809547c8.52813721 0 15.82031227 2.98608422 21.83697534 9.06207276C879.78271508 496.24395728 882.78857422 503.45208717 882.78857422 512c0 8.55285621-3.00585914 15.85986352-9.07196021 21.83697533-6.01666236 6.07598853-13.30883813 9.06207276-21.83697534 9.06207276h-61.79809547c-8.52813721 0-15.80053734-2.98608422-21.86663841-9.06207276-6.01666236-5.97711182-9.05712867-13.2890625-9.05712867-21.83697533 0-8.55285621 3.04046631-15.76098609 9.05712867-21.83697533 6.06610107-6.07598853 13.33850122-9.06207276 21.86663841-9.06207276zM512 141.21142578c8.52813721 0 15.79064917 3.08990502 21.85180688 9.06207276 6.02160645 6.08093262 9.05712867 13.3928833 9.05712867 21.83697533v61.79809546c0 8.55285621-3.03552222 15.85986352-9.0521853 21.83697534-6.06610107 6.07598853-13.32861305 9.16589356-21.85675025 9.16589355-8.53802467 0-15.80053734-3.08990502-21.86663842-9.16589355-6.01666236-5.97711182-9.0521853-13.2890625-9.05218458-21.83697534V172.11047387c0-8.44409203 3.03552222-15.76098609 9.05218458-21.83697533C496.20440674 144.3013308 503.46691871 141.21142578 512.00494408 141.21142578zM271.81304907 240.7063601c8.36499023 0 15.61267066 3.08990502 21.743042 9.16589356l43.66900659 43.67394996c6.14025879 6.07598853 9.17083764 13.38793922 9.17083764 21.72821044 0 8.55285621-3.01080323 15.86480689-9.05712938 21.83697534-6.03149391 6.08093262-13.30389404 9.06207276-21.85180617 9.06207275-8.69622827 0-16.02795386-2.98608422-21.95068359-8.85443115l-43.68383814-43.67395068c-5.97216773-5.97216773-8.92858886-13.28411842-8.92858886-22.03967284 0-8.55285621 3.00585914-15.76098609 9.07196021-21.83697462 6.01666236-5.97216773 13.30883813-9.06207276 21.85675096-9.06207276h-0.03955126z m436.93725586 436.91253615c8.36499023 0 15.60772729 2.98608422 21.72326709 9.16589355l43.67394995 43.67395067c6.1353147 6.17980933 9.18566918 13.38793922 9.18566919 21.93585205 0 8.34521461-3.05035376 15.65716529-9.18566919 21.73315382-6.1105957 6.17980933-13.35827613 9.16589356-21.72326636 9.16589356-8.52813721 0-15.84008789-2.98608422-21.98034668-9.16589356l-43.66900659-43.66900587c-5.95733618-5.87329102-8.91375732-13.1852417-8.91375732-21.73315453 0-8.55285621 3.01080323-15.86480689 9.05712866-21.94079614 6.03149391-6.07598853 13.32861305-9.16589356 21.85180689-9.16589355h-0.01977564zM512.00494408 388.40380836c-34.12243628 0-63.22192359 12.05310035-87.39239525 36.2532351-24.1358645 24.10125732-36.21368384 53.25018335-36.21368384 87.34295654 0 34.0927732 12.07782007 63.24169922 36.21368384 87.44677734C448.78796387 623.53814721 477.88250709 635.59619164 512 635.59619164c34.12243628 0 63.23181176-12.05310035 87.4072268-36.15435838C623.51837158 575.2466433 635.59619164 546.09771729 635.59619164 512c0-34.0927732-12.07782007-63.24169922-36.18896484-87.34295654C575.23181176 400.45690942 546.12243628 388.40380836 512 388.40380836zM172.12036133 481.10095191h61.79809547c8.53802467 0 15.80053734 2.98608422 21.86663841 9.06207276 6.01666236 6.08093262 9.05712867 13.2890625 9.05712867 21.83697533 0 8.55285621-3.04046631 15.85986352-9.05712867 21.83697533-6.06610107 6.07598853-13.32861305 9.06207276-21.86663841 9.06207276h-61.79809547c-8.52813721 0-15.81042481-2.98608422-21.83697534-9.06207276C144.21728492 527.85986352 141.21142578 520.54791283 141.21142578 512c0-8.55285621 3.00585914-15.76098609 9.07196021-21.83697533 6.03149391-6.07598853 13.30883813-9.06207276 21.83697534-9.06207276zM512.00494408 759.19238258c8.52813721 0 15.79064917 2.98608422 21.85180617 9.06207274 6.02160645 6.08093262 9.05712867 13.2890625 9.05712938 21.83697535v61.79809546c0 8.55285621-3.03552222 15.85986352-9.0521853 21.83697533C527.79559326 879.80249 520.53308129 882.78857422 512 882.78857422c-8.53802467 0-15.80053734-2.98608422-21.86663842-9.06207276-6.01666236-5.97711182-9.0521853-13.2890625-9.05218458-21.83697533v-61.79809546c0-8.55285621 3.03552222-15.76098609 9.05218458-21.83697534 6.06610107-6.07598853 13.32861305-9.06207276 21.86663842-9.06207275z m-196.47839379-81.57348633c8.5034182 0 15.80053734 2.98608422 21.84686279 9.16589355 6.03149391 6.08093262 9.07196021 13.3928833 9.07196021 21.94079614 0 8.44409203-3.08001685 15.65222192-9.19555664 21.72821044l-43.67394995 43.67394996c-6.10565162 6.17980933-13.34838867 9.16589356-21.72326637 9.16589356-8.54791283 0-15.84008789-2.98608422-21.85180687-8.96319533-6.07104516-6.07598853-9.0769043-13.38793922-9.0769043-21.93585205 0-8.65173364 2.95642114-15.96862769 8.92858887-21.94079614l43.68383813-43.66900658c6.10565162-6.17980933 13.44232202-9.16589356 21.95068359-9.16589355h0.03955054zM512 326.60571289c33.628052 0 64.6506958 8.34521461 93.0481565 24.81811547 28.42712378 16.69042992 50.92163109 39.1404419 67.4637456 67.56756568 16.57177758 28.32824708 24.86755347 59.32617188 24.86755347 93.00860596 0 33.68243408-8.27600098 64.68035888-24.86755347 93.10748267-16.58166504 28.32824708-39.08605981 50.77825904-67.4637456 67.4637456-28.36285424 16.58166504-59.37561059 24.82305884-93.0481565 24.82305884-33.66760254 0-64.67047143-8.24139381-93.05804468-24.81811547-28.37768578-16.69042992-50.86230492-39.14538598-67.46374487-67.46868897-16.58166504-28.42712378-24.86755347-59.42504859-24.86755348-93.10748267 0-33.68243408 8.31555152-64.68035888 24.86755348-93.00860596 16.55200195-28.42712378 39.03662109-50.87713647 67.46374487-67.56262231C447.35424828 334.94598413 478.371948 326.60571289 512 326.60571289z" p-id="1941"></path></svg></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">go-zero</a><div class="react-toggle themeToggleInSidebar_qGRI react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_1y7K" style="margin-left:2px"><svg t="1651718448922" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2080" width="200" height="200"><path d="M439.04383639 224.33271976a289.43717504 289.43717504 0 0 0-89.06329676 39.44690807c-27.5075319 18.12412161-51.158867 39.64960558-70.96389486 64.57645191-19.79019562 24.92684633-35.31880082 53.25011237-46.62042137 84.97474006C221.10449032 445.05050411 215.45368042 478.01109252 215.45368042 512c0 40.16870887 7.81621301 78.48347702 23.45358166 115.04318192 15.64725682 36.67341315 36.77228986 68.19039996 63.2910532 94.76354538 26.53359488 26.56820206 58.11485196 47.57952611 94.69927585 63.23667111 36.59431134 15.65714501 75.00301286 23.48324474 115.16183354 23.48324475 33.97407594 0 66.85061917-5.56182137 98.62468557-16.89310498 31.76417894-11.32633953 60.10227581-26.77584294 85.01429133-46.65502781 24.87740834-19.77536407 46.43255539-43.46625042 64.57150781-70.96389488a290.15403174 290.15403174 0 0 0 39.43701989-88.98913905c-8.3056532 0.72180079-17.71378249 1.13213991-28.0958481 1.1321392-45.21637032 0-88.35138342-8.85936294-129.45942212-26.46932463-41.1327577-17.71872658-76.62459295-41.50848964-106.44089858-71.27535655C505.84007277 458.54719011 482.10963587 423.01086095 464.42057238 381.91765379 446.7562286 340.81455917 437.94135957 297.65977044 437.94135957 252.4483442c0-10.40184195 0.39550758-19.77536407 1.15685891-28.01674772l-0.049438-0.09887672zM512.02976157 141.21192041c8.32542811 0 16.51242896 0.31146168 24.6054972 0.92944167-16.4036648 35.32374419-24.60549719 72.09603405-24.60549719 110.30698212 0 35.12104668 6.84227598 68.69961578 20.58121076 100.83458258 13.70927096 32.03114601 32.15474243 59.63261126 55.35124448 82.80933769 23.16683898 23.17178306 50.76830423 41.60736635 82.82416923 55.30674985 32.02125855 13.69938351 65.654209 20.60098567 100.78514387 20.60098568 38.23072298 0 75.03267594-8.24138293 110.35147675-24.62032874 0.59326099 8.14250622 0.86517214 16.28006837 0.86517213 24.62032874 0 33.57856837-4.43956893 66.43533597-13.29893256 98.46648269-8.90880166 32.03114601-21.28817928 61.69419283-37.24195443 88.78149743-15.92411206 27.19112615-35.31880082 52.11797247-58.09013296 74.87941716-22.77627549 22.76144395-47.74267309 42.12152555-74.87447306 58.09013223-27.15157487 15.96366261-56.75529553 28.32326532-88.78644152 37.28644905A368.16784419 368.16784419 0 0 1 512.00009921 882.78807959a368.20739474 368.20739474 0 0 1-98.48625832-13.28904439c-32.03609009-8.95824037-61.6249792-21.31784236-88.79138561-37.28150569-27.12685589-15.96860669-52.08336529-35.32868827-74.89919206-58.09013223-22.7515565-22.76144395-42.13635709-47.68829101-58.05058169-74.87941715-15.96366261-27.0922487-28.34304097-56.75529553-37.2518426-88.78149744A367.9354836 367.9354836 0 0 1 141.21201889 512c0-33.57856837 4.4494571-66.43533597 13.30882004-98.46648269 8.90880166-32.03114601 21.28817928-61.69419283 37.25184259-88.78149744 15.91916798-27.19112615 35.29902519-52.11797247 58.0505817-74.87941715 22.81582676-22.86526476 47.77233617-42.22534634 74.89919206-58.09013223C351.89380578 175.81880789 381.4826949 163.36032846 413.51878498 154.50096479A368.20739474 368.20739474 0 0 1 512.00009921 141.21192041h0.02966236z" p-id="2081" fill="#ffffff"></path></svg></span></div><div class="react-toggle-track-x"><span class="toggle_1y7K" style="margin-left:1px"><svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1940" width="25" height="25"><path d="M752.41931153 240.7063601c8.36993432 0 15.62255883 3.08990502 21.72821045 9.16589356 6.1353147 6.08093262 9.18566918 13.3928833 9.18566918 21.73315382 0 8.55285621-3.05035376 15.85986352-9.18566918 21.94079614l-43.67394996 43.66900658c-5.93261719 5.97216773-13.17041016 8.95825195-21.72326709 8.95825195-8.87420678 0-16.20098901-2.98608422-22.08911085-8.75061035-5.88317847-5.87329102-8.80004906-13.2890625-8.80004906-22.14843774 0-8.54791283 2.95642114-15.75604272 8.91375732-21.72821044l43.66900659-43.67394996c6.14025879-6.07598853 13.44726539-9.16589356 21.98034668-9.16589356z m37.66223167 240.39459181h61.79809547c8.52813721 0 15.82031227 2.98608422 21.83697534 9.06207276C879.78271508 496.24395728 882.78857422 503.45208717 882.78857422 512c0 8.55285621-3.00585914 15.85986352-9.07196021 21.83697533-6.01666236 6.07598853-13.30883813 9.06207276-21.83697534 9.06207276h-61.79809547c-8.52813721 0-15.80053734-2.98608422-21.86663841-9.06207276-6.01666236-5.97711182-9.05712867-13.2890625-9.05712867-21.83697533 0-8.55285621 3.04046631-15.76098609 9.05712867-21.83697533 6.06610107-6.07598853 13.33850122-9.06207276 21.86663841-9.06207276zM512 141.21142578c8.52813721 0 15.79064917 3.08990502 21.85180688 9.06207276 6.02160645 6.08093262 9.05712867 13.3928833 9.05712867 21.83697533v61.79809546c0 8.55285621-3.03552222 15.85986352-9.0521853 21.83697534-6.06610107 6.07598853-13.32861305 9.16589356-21.85675025 9.16589355-8.53802467 0-15.80053734-3.08990502-21.86663842-9.16589355-6.01666236-5.97711182-9.0521853-13.2890625-9.05218458-21.83697534V172.11047387c0-8.44409203 3.03552222-15.76098609 9.05218458-21.83697533C496.20440674 144.3013308 503.46691871 141.21142578 512.00494408 141.21142578zM271.81304907 240.7063601c8.36499023 0 15.61267066 3.08990502 21.743042 9.16589356l43.66900659 43.67394996c6.14025879 6.07598853 9.17083764 13.38793922 9.17083764 21.72821044 0 8.55285621-3.01080323 15.86480689-9.05712938 21.83697534-6.03149391 6.08093262-13.30389404 9.06207276-21.85180617 9.06207275-8.69622827 0-16.02795386-2.98608422-21.95068359-8.85443115l-43.68383814-43.67395068c-5.97216773-5.97216773-8.92858886-13.28411842-8.92858886-22.03967284 0-8.55285621 3.00585914-15.76098609 9.07196021-21.83697462 6.01666236-5.97216773 13.30883813-9.06207276 21.85675096-9.06207276h-0.03955126z m436.93725586 436.91253615c8.36499023 0 15.60772729 2.98608422 21.72326709 9.16589355l43.67394995 43.67395067c6.1353147 6.17980933 9.18566918 13.38793922 9.18566919 21.93585205 0 8.34521461-3.05035376 15.65716529-9.18566919 21.73315382-6.1105957 6.17980933-13.35827613 9.16589356-21.72326636 9.16589356-8.52813721 0-15.84008789-2.98608422-21.98034668-9.16589356l-43.66900659-43.66900587c-5.95733618-5.87329102-8.91375732-13.1852417-8.91375732-21.73315453 0-8.55285621 3.01080323-15.86480689 9.05712866-21.94079614 6.03149391-6.07598853 13.32861305-9.16589356 21.85180689-9.16589355h-0.01977564zM512.00494408 388.40380836c-34.12243628 0-63.22192359 12.05310035-87.39239525 36.2532351-24.1358645 24.10125732-36.21368384 53.25018335-36.21368384 87.34295654 0 34.0927732 12.07782007 63.24169922 36.21368384 87.44677734C448.78796387 623.53814721 477.88250709 635.59619164 512 635.59619164c34.12243628 0 63.23181176-12.05310035 87.4072268-36.15435838C623.51837158 575.2466433 635.59619164 546.09771729 635.59619164 512c0-34.0927732-12.07782007-63.24169922-36.18896484-87.34295654C575.23181176 400.45690942 546.12243628 388.40380836 512 388.40380836zM172.12036133 481.10095191h61.79809547c8.53802467 0 15.80053734 2.98608422 21.86663841 9.06207276 6.01666236 6.08093262 9.05712867 13.2890625 9.05712867 21.83697533 0 8.55285621-3.04046631 15.85986352-9.05712867 21.83697533-6.06610107 6.07598853-13.32861305 9.06207276-21.86663841 9.06207276h-61.79809547c-8.52813721 0-15.81042481-2.98608422-21.83697534-9.06207276C144.21728492 527.85986352 141.21142578 520.54791283 141.21142578 512c0-8.55285621 3.00585914-15.76098609 9.07196021-21.83697533 6.03149391-6.07598853 13.30883813-9.06207276 21.83697534-9.06207276zM512.00494408 759.19238258c8.52813721 0 15.79064917 2.98608422 21.85180617 9.06207274 6.02160645 6.08093262 9.05712867 13.2890625 9.05712938 21.83697535v61.79809546c0 8.55285621-3.03552222 15.85986352-9.0521853 21.83697533C527.79559326 879.80249 520.53308129 882.78857422 512 882.78857422c-8.53802467 0-15.80053734-2.98608422-21.86663842-9.06207276-6.01666236-5.97711182-9.0521853-13.2890625-9.05218458-21.83697533v-61.79809546c0-8.55285621 3.03552222-15.76098609 9.05218458-21.83697534 6.06610107-6.07598853 13.32861305-9.06207276 21.86663842-9.06207275z m-196.47839379-81.57348633c8.5034182 0 15.80053734 2.98608422 21.84686279 9.16589355 6.03149391 6.08093262 9.07196021 13.3928833 9.07196021 21.94079614 0 8.44409203-3.08001685 15.65222192-9.19555664 21.72821044l-43.67394995 43.67394996c-6.10565162 6.17980933-13.34838867 9.16589356-21.72326637 9.16589356-8.54791283 0-15.84008789-2.98608422-21.85180687-8.96319533-6.07104516-6.07598853-9.0769043-13.38793922-9.0769043-21.93585205 0-8.65173364 2.95642114-15.96862769 8.92858887-21.94079614l43.68383813-43.66900658c6.10565162-6.17980933 13.44232202-9.16589356 21.95068359-9.16589355h0.03955054zM512 326.60571289c33.628052 0 64.6506958 8.34521461 93.0481565 24.81811547 28.42712378 16.69042992 50.92163109 39.1404419 67.4637456 67.56756568 16.57177758 28.32824708 24.86755347 59.32617188 24.86755347 93.00860596 0 33.68243408-8.27600098 64.68035888-24.86755347 93.10748267-16.58166504 28.32824708-39.08605981 50.77825904-67.4637456 67.4637456-28.36285424 16.58166504-59.37561059 24.82305884-93.0481565 24.82305884-33.66760254 0-64.67047143-8.24139381-93.05804468-24.81811547-28.37768578-16.69042992-50.86230492-39.14538598-67.46374487-67.46868897-16.58166504-28.42712378-24.86755347-59.42504859-24.86755348-93.10748267 0-33.68243408 8.31555152-64.68035888 24.86755348-93.00860596 16.55200195-28.42712378 39.03662109-50.87713647 67.46374487-67.56262231C447.35424828 334.94598413 478.371948 326.60571289 512 326.60571289z" p-id="1941"></path></svg></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg t="1651714104711" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8547" width="24" height="24" style="vertical-align:text-bottom;margin-right:5px"><path d="M0 0h1024v1024H0z" fill="#FFFFFF" p-id="8548"></path><path d="M785.09056 297.86112l-0.01024-176.40448-253.61408 87.18336 253.62432 89.22112zM499.3024 197.64224L232.58112 102.4v184.1664l266.72128-88.92416zM334.1824 337.37728l44.46208-12.70784v53.97504l95.26272-34.9184v171.4688l-38.11328 12.6976v-25.38496l-63.50848 25.38496 0.27648 95.41632-38.37952 12.55424-0.28672-94.44352-63.21152 24.576 0.01024 19.05664-38.12352 12.6976 0.01024-171.45856 101.60128-31.75424v-57.15968z m101.61152 60.33408l-57.14944 22.2208v63.50848l57.14944-19.05664v-66.67264zM270.68416 521.54368l63.50848-22.23104-0.01024-66.67264-63.49824 22.2208v66.68288z m247.67488-308.40832l-342.9376 117.88288v469.9648l342.9376-114.3296V213.13536z m9.55392 489.41056c-123.38176 41.30816-248.24832 82.5344-371.54816 123.83232l-0.01024-508.0576L804.1472 102.4v202.16832l63.50848 20.10112-0.01024 489.0112-339.73248-111.13472z m266.6496-20.1728c-14.92992-53.98528-29.9008-108.19584-44.9024-162.54976-15.0528-54.49728-30.11584-109.24032-45.2608-164.15744-16.22016-6.28736-32.48128-12.60544-48.81408-18.944-14.85824 43.61216-29.76768 87.36768-44.6976 131.21536l-45.056 132.28032c16.57856 5.96992 33.16736 11.9296 49.68448 17.85856 6.4-20.1728 12.8-40.36608 19.18976-60.54912 30.49472 11.1616 60.9792 22.3232 91.46368 33.47456 6.5024 24.65792 12.99456 49.28512 19.51744 73.8304 16.32256 5.86752 32.63488 11.70432 48.87552 17.54112zM711.30112 535.8592c-10.5472-40.2944-21.10464-80.59904-31.58016-120.90368-10.31168 32.5632-20.60288 65.14688-30.90432 97.73056 20.8384 7.71072 41.65632 15.45216 62.48448 23.17312z m-30.53568 312.10496c-121.21088 75.776-241.60256 85.18656-365.38368 6.51264l-6.62528 10.35264c118.45632 75.264 236.3392 74.07616 357.65248 6.01088 7.10656-4.03456 14.08-8.192 20.992-12.51328L701.44 880.25088l31.87712-58.5728-66.53952 4.42368 13.98784 21.8624z" p-id="8549"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/docs/blog/cache/redis-cache" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/cn/docs/blog/cache/redis-cache" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">中文简体</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/prepare/prepare">Preparation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/quick-start/quick-start">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/component/components">Components</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/advance/advance">Guides</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist" sidebarid="goctl">goctl</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/goctl">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/api">API Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/zrpc">RPC Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/model">Model Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/completion">Completion</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/tutorial/tutorial">Tutorial</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Eco</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/eco/plugins">Goctl Plugin</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/eco/editor">Editor Plugin</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/eco/distributed-transaction">Distributed Transaction (DTM)</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/eco/showcase">Showcase</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/community/about-us">About us</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/contribute">Contributing</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="menu__link">Discord</a></li></ul></li><li class="menu__list-item"><a class="menu__link" sidebarid="blog" href="/docs/blog/blog">Blog</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">More</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/resource-center/learning-resource">Resource Center</a></li><li class="menu__list-item"><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="menu__link">Video Tutorial</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="menu__link">Development Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/design/design">Design Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq/troubleshooting">FAQ</a></li></ul></li></ul></div></div></div></nav><div class="wrapper_DIJ0"><div class="doc_D+rh"><div class="doc__sidebar_gVFN" role="complementary"><div class="sidebar_LIo8"><div class="menu menu--responsive thin-scrollbar menu_oAhv"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_nrF-" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" href="/docs/blog/blog">Blog</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Governance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/bloom">Bloom Filter</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/breaker-algorithms">Fusing Principle and Implementation</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/loadshedding">Load Shedding</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/periodlimit">Period Limit</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/tokenlimit">Token Limit</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u menu__link--sublist menu__link--active" href="#!">Cache</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/docs/blog/cache/cache">DB caching mechanism</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menuLink_Zq3u menu__link--active active" tabindex="0" href="/docs/blog/cache/redis-cache">go-zero cache design for persistence layer cache</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/docs/blog/cache/business-cache">go-zero cache design for business-level caching</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/docs/blog/cache/collection">Caching via collection</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/executors">Executors</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/keywords">Efficient keyword replacement and sensitive word filtering tool</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/logx">logx</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Concurrency</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/fx">Fx</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/mapreduce">Mapreduce</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/stream">Stream processing</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/redis-lock">Redis Lock</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/sharedcalls">SharedCalls</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Principle</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/principle/timing-wheel">TimingWheel</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Showcase</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/shorturl">Rapid development of microservices</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/zrpc">Enterprise RPC framework zRPC</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/mysql">Mysql</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/mapping">Mapping</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/datacenter">Data center</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/go-queue">Queue</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/go-zero-looklook">Develop a travel system using go-zero go-zero-looklook</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/metric">Microservice metrics monitoring based on prometheus</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Exchange</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/share/online-exchange">Online Communication on October 3,2020</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/share/goctl-share-part-one">goctl share part 1</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/share/goctl-share-part-two">goctl share part 2</a></li></ul></li></ul></div></div></div><main class="doc__main_VklL"><div class="padding-vert--lg container doc__item-wrapper_FIxd"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">go-zero cache design for persistence layer cache</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="cache-design-principles"></a>Cache design principles<a class="hash-link" href="#cache-design-principles" title="Direct link to heading">#</a></h2><p>We only delete caches, we don&#x27;t update them. Once the data in the DB is modified, we delete the corresponding cache directly instead of updating it.</p><p>Let&#x27;s see how to delete the cache in the right order.</p><ul><li>Delete the cache first, then update the DB</li></ul><p><img alt="redis-cache-01" src="/assets/images/redis-cache-01-c05028cdbb789f3f929f0c0dd8a39c92.png"></p><p>Let&#x27;s look at the case of two concurrent requests. A requests to update the data and deletes the cache first, then B requests to read the data, at this time the cache has no data, it will load the data from DB and write back to the cache, then A updates the DB, then at this time the data in the cache will remain dirty until the cache expires or there is a new request to update the data. As shown in the figure</p><p><img alt="redis-cache-02" src="/assets/images/redis-cache-02-5c1917bc768c456848139d89b935cd86.png"></p><ul><li><p>Update the DB first, then delete the cache</p><p>![redis-cache-03](. /../resource/redis-cache-03.png)</p></li></ul><p>A request to update the DB first, then B request to read the data, at this time the return is the old data, at this time can be considered as A request has not been updated, the final consistency, can be accepted, and then A deleted the cache, subsequent requests will get the latest data, as shown in the figure
<img alt="redis-cache-04" src="/assets/images/redis-cache-04-54b4f221ab656d99239263735576e561.png"></p><p>Let&#x27;s look at the normal request flow again.</p><ul><li>The first request updates the DB and deletes the cache</li><li>The second request reads the cache and has no data, so it reads the data from the DB and writes it back to the cache</li><li>Subsequent read requests can all read directly from the cache
<img alt="redis-cache-05" src="/assets/images/redis-cache-05-f1847d60569f085c07e97d9d3e7482e4.png"></li></ul><p>Let&#x27;s look at what happens with DB queries, assuming there are seven columns of data in the row record ABCDEFG.</p><ul><li><p>A request that queries only part of the column data, such as a request for ABC, CDE or EFG among them, as in the figure
<img alt="redis-cache-06" src="/assets/images/redis-cache-06-e590e267d43fcbae67d43f6507258033.png"></p></li><li><p>Query a single complete row of records, as shown
![redis-cache-07](. /../resource/redis-cache-07.png)</p></li><li><p>Query multiple rows of records with some or all columns, as in
![redis-cache-08](. /../resource/redis-cache-08.png)</p></li></ul><p>For the above three cases, first, we do not use partial queries because partial queries cannot be cached, and once cached, there is no way to locate what data needs to be deleted once the data is updated; second, for multi-row queries, according to the actual scenario and needs, we will establish the corresponding mapping from query conditions to primary keys in the business layer; and for single-row complete record queries, go-zero has a built-in complete cache management approach. So the core principle is: <strong>go-zero must cache complete row records</strong>.</p><p>Let&#x27;s detail the three built-in cache handling scenarios for go-zero.</p><ul><li>Primary key-based caching<div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><div tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">PRIMARY KEY (``id``)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div></li></ul><p>This is relatively the easiest cache to handle, just use the primary key as the key to cache row records in redis.</p><ul><li>Caching based on unique indexes
<img alt="redis-cache-09" src="data:image/webp;base64,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"></li></ul><p>In the database design, if you look up data by index, the engine will first look up the primary key in the index-&gt;primary key tree and then look up the row records by the primary key, which introduces an indirect layer to solve the problem of index-to-row record correspondence. The same principle is used in go-zero&#x27;s cache design.</p><p>Index-based caching is divided into single-column unique indexes and multi-column unique indexes.</p><p>But for go-zero, single-column and multi-column are just different ways to generate cache keys, the control logic behind them is the same. Then go-zero has built-in cache management to better control data consistency issues, and also built-in to prevent cache breakthroughs, penetrations, and avalanches (these were carefully discussed during the gopherchina conference, see the subsequent gopherchina sharing video).</p><p>In addition, go-zero has built-in statistics for cache accesses and access hits, as follows.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><div tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">dbcache(sqlc) - qpm: 5057, hit_ratio: 99.7%, hit: 5044, miss: 13, db_fails: 0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>You can see more detailed statistics, so that we can analyze the cache usage. For cases where the cache hit rate is very low or the request volume is very small, we can remove the cache, which can also reduce the cost.</p><ul><li><p>The single column unique index is as follows.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><div tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">UNIQUE KEY `product_idx` (`product`)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div></li><li><p>A multi-column unique index is as follows.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><div tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">UNIQUE KEY `vendor_product_idx` (`vendor`, `product`)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="explanation-of-caching-code"></a>Explanation of caching code<a class="hash-link" href="#explanation-of-caching-code" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1-primary-key-based-caching-logic"></a>1. Primary key based caching logic<a class="hash-link" href="#1-primary-key-based-caching-logic" title="Direct link to heading">#</a></h3><p><img alt="redis-cache-10" src="/assets/images/redis-cache-10-cb86054e7a45b09579b82edb6da98613.png"></p><p>The concrete implementation code is as follows.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cc CachedConn</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">QueryRow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> key </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> query QueryFn</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> cc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Take</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">query</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">db</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The <code>Take</code> method here is to go through the <code>key</code> to get the data from the cache first, if you get it, return it directly, if not, then go through the <code>query</code> method to the <code>DB</code> to read the full row and write it back to the cache, and then return the data. The whole logic is still relatively simple to understand.</p><p>Let&#x27;s look at the implementation of <code>Take</code> in detail.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c cacheNode</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">Take</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> key </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> query </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">doTake</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">SetCache</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>The logic of <code>Take</code> is as follows.</p><ul><li>Find the data from the cache using the key</li><li>If found, return the data</li><li>If not found, use the query method to read the data</li><li>After reading, call c.SetCache(key, v) to set the cache</li></ul><p>The <code>doTake</code> code and explanation are as follows.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4">// v - The data object to be read</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// key - The cache key</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// query - The Method used to read complete data from DB</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// cacheVal - Thme Method used to write cache</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c cacheNode</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">doTake</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> key </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> query </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  cacheVal </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Use a barrier to prevent cache hitting and ensure that only one request is made to </span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// load the data corresponding to the key within a process</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  val</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> fresh</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">barrier</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">DoEx</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// Read data from the cache</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">doGetCache</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4">// If it&#x27;s a pre-placeholder (to prevent cache penetration), then return the pre-defined errNotFound</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4">// If it&#x27;s an unknown error, then return it directly, because we can&#x27;t just drop the cache error and send all requests to the DB.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4">// This will hang the DB in a high concurrency scenario</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">==</span><span class="token plain"> errPlaceholder </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">errNotFound</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">else</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">errNotFound </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4">// why we just return the error instead of query from db,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4">// because we don&#x27;t allow the disaster pass to the DBs.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4">// fail fast, in case we bring down the dbs.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4">// Request DB</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4">// If the returned error is errNotFound, then we need to set the placeholder in the cache to prevent cache penetration</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">query</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">==</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">errNotFound </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">setCacheWithNotFound</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          logx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">errNotFound</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">else</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#6272a4">// Statistics DB failure</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">stat</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">IncrementDbFails</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4">// Writing data to cache</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">cacheVal</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        logx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// Return json serialized data</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> jsonx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Marshal</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> fresh </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// got the result from previous ongoing query</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">stat</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">IncrementTotal</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">stat</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">IncrementHit</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Write the data to the incoming v object</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> jsonx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Unmarshal</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">val</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token builtin" style="color:#bd93f9">byte</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="2-caching-logic-based-on-unique-index"></a>2. Caching logic based on unique index<a class="hash-link" href="#2-caching-logic-based-on-unique-index" title="Direct link to heading">#</a></h3><p>Because this block is more complex, I have marked the response blocks and logic with different colors. <code>block 2</code> is actually the same as the primary key-based cache, so here we focus on the logic of <code>block 1</code>.
<img alt="redis-cache-11" src="/assets/images/redis-cache-11-c2989ee89c9f5f204d294bbed81f1bad.webp"></p><p>The block 1 part of the code block is divided into two cases.</p><ul><li><p>The primary key can be found from the cache through the index, so the logic of <code>block 2</code> will be done directly with the primary key, and the logic of the cache based on the primary key will be followed as above.</p></li><li><p>The primary key cannot be found from the cache through the index.</p><ul><li>Search the complete row from DB by index, if there is <code>error</code>, return</li><li>When the complete row record is found, the cache of primary key to complete row record and index to primary key will be written to <code>redis</code> at the same time.</li><li>Return the required row data</li></ul></li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4">// v - The data object to be read</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// key - Cache key generated by indexing</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// keyer - Method for generating primary key-based cache keys with primary keys</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// indexQuery - Method to read complete data from DB with index, need to return primary key</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// primaryQuery - Method to get complete data from DB with primary key</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cc CachedConn</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">QueryRowIndex</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> key </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> keyer </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">primary </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  indexQuery IndexQueryFn</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> primaryQuery PrimaryQueryFn</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">var</span><span class="token plain"> primaryKey </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">var</span><span class="token plain"> found </span><span class="token builtin" style="color:#bd93f9">bool</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">//  First query the cache by index to see if there is a cache of indexes to the primary key</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> cc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">TakeWithExpire</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">primaryKey</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">val </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> expire time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Duration</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">err </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// If there is no index to the primary key cache, then query the complete data by index</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    primaryKey</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">indexQuery</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">db</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// The complete data is queried by the index, set found, and used directly later, no need to read data from the cache again</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    found </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">true</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// Save the primary key to complete data mapping to the cache, the TakeWithExpire method already saves the index to primary key mapping to the cache</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> cc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">SetCacheWithExpire</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#8be9fd">keyer</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">primaryKey</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> expire</span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain">cacheSafeGapBetweenIndexAndPrimary</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// The data has already been found by the index, just return it</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> found </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Read data from the cache by primary key, and if the cache doesn&#x27;t have it, read it from the DB by primaryQuery method and write back to the cache before returning the data.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> cc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Take</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">keyer</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">primaryKey</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">primaryQuery</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">cc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">db</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> primaryKey</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>Let&#x27;s look at a practical example</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">m </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">defaultUserModel</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">FindOneByUser</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">user </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">User</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">var</span><span class="token plain"> resp User</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Generate index-based key</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  indexKey </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Sprintf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;%s%v&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> cacheUserPrefix</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  err </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> m</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">QueryRowIndex</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">resp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> indexKey</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// Generate key for complete data cache based on primary key</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">primary </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Sprintf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;user#%v&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// Index-based DB query method</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">conn sqlx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">SqlConn</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">i </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> e </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      query </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Sprintf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;select %s from %s where user = ? limit 1&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> userRows</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> m</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">table</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">QueryRow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">resp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Id</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#6272a4">// Primary key-based DB query method</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">conn sqlx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">SqlConn</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> primary </span><span class="token keyword" style="color:#ff79c6">interface</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      query </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Sprintf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;select %s from %s where id = ?&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> userRows</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> m</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">table</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">QueryRow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">resp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> primary</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// error handling, need to determine whether the return is sqlc.ErrNotFound, if so, we use this package definition of ErrNotFound return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// Avoid user awareness of whether the cache is being used, and also isolate the underlying dependencies</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">switch</span><span class="token plain"> err </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">case</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">resp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">case</span><span class="token plain"> sqlc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ErrNotFound</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> ErrNotFound</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">default</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>All of the above automatic cache management code is available via <a href="/docs/goctl/goctl">goctl</a>, and our team&#x27;s internal <code>CRUD</code> and cache are basically generated via <a href="/docs/goctl/goctl">goctl</a>, which saves a lot of development time, and the cache code itself is very error-prone, and even with good code experience, it&#x27;s hard to get it right every time, so we recommend using automatic cache code generation tools to avoid errors whenever possible.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/zeromicro/portal/edit/main/docs/blog/cache/redis-cache.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2023-02-24T04:03:13.000Z" class="lastUpdatedDate_nN9m">2/24/2023</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/blog/cache/cache"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« DB caching mechanism</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/blog/cache/business-cache"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">go-zero cache design for business-level caching »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cache-design-principles" class="table-of-contents__link">Cache design principles</a></li><li><a href="#explanation-of-caching-code" class="table-of-contents__link">Explanation of caching code</a><ul><li><a href="#1-primary-key-based-caching-logic" class="table-of-contents__link">1. Primary key based caching logic</a></li><li><a href="#2-caching-logic-based-on-unique-index" class="table-of-contents__link">2. Caching logic based on unique index</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer_rm3y section_bQ6r"><div class="footer__inner_OWoZ section--inner_6-fB"><div class="footer__column_+a5z footer__column--left_4bpB"><div><img alt="go-zero logo" class="footer__logo_ayM4" height="27" src="/img/footer/go-zero.svg" title="go-zero" width="108"><img alt="stars" height="27" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="footer__logo_ayM4"><img alt="forks" height="27" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="footer__logo_ayM4"></div><p class="footer__tagline_b1u+">go-zero is a web and rpc framework with many built-in engineering best practices.</p><a class="footer__github_okz3 button_f7Ff button--icon_q89D button--secondary_x3vq button--xsmall_fwzy" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_+a5z footer__column--right_FGdI"><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">zeromicro</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-api" rel="noopener noreferrer" target="_blank">zero-api</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-queue" rel="noopener noreferrer" target="_blank">go-queue</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/awesome-zero" rel="noopener noreferrer" target="_blank">awesome-zero</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-examples" rel="noopener noreferrer" target="_blank">zero-example</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Community</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank">GitHub</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://discord.gg/4JQvC5A4Fe" rel="noopener noreferrer" target="_blank">Discord</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Links</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://legacy.go-zero.dev" rel="noopener noreferrer" target="_blank">Older Doc</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="/docs/blog/blog">Blog</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" rel="noopener noreferrer" target="_blank">Roadmap</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://landscape.cncf.io/?selected=go-zero" rel="noopener noreferrer" target="_blank">CNCF</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Chat</li><li class="footer__item_K578"><div data-rmiz-wrap="visible"><img alt="discord" width="80" src="/img/footer/discord.png" class="footer__img_4fbU"><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div></li></ul></div></div></div><div class="footer__bottom_rXtt"><p class="footer__copyright_9e29">Copyright © 2023 zeromicro</p><ul><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/portal/blob/main/LICENSE">License</a></li></ul><p></p></div></footer></div>
<script src="/assets/js/main.9f8372e2.js" defer="defer"></script>
</body>
</html>