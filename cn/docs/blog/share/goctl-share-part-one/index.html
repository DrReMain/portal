<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="zeromicro">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="https://go-zero.dev/favicon.png">
<link rel="icon" href="https://go-zero.dev/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="https://go-zero.dev/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/cn/blog/rss.xml" title="go-zero Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cn/blog/atom.xml" title="go-zero Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZD0YKV3XQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XZD0YKV3XQ",{anonymize_ip:!0})</script>
<link rel="manifest" href="//manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c"><title data-react-helmet="true">goctl 效能工具深度解析（一） | go-zero</title><meta data-react-helmet="true" property="og:image" content><meta data-react-helmet="true" name="twitter:image" content><meta data-react-helmet="true" name="twitter:description" content="go-zero 是一个集成了各种工程实践的 web 和 rpc 框架。通过弹性设计保障了大并发服务端的稳定性，经受了充分的实战检验。"><meta data-react-helmet="true" name="twitter:title" content="Introduction | go-zero"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Introduction | go-zero&quot;"><meta data-react-helmet="true" property="og:title" content="goctl 效能工具深度解析（一） | go-zero"><meta data-react-helmet="true" name="description" content="1. goctl 的诞生"><meta data-react-helmet="true" property="og:description" content="1. goctl 的诞生"><link rel="stylesheet" href="/cn/assets/css/styles.284162f0.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="">
<meta itemprop="description" content="go-zero 是一个集成了各种工程实践的 web 和 rpc 框架。通过弹性设计保障了大并发服务端的稳定性，经受了充分的实战检验。">
<meta itemprop="url" content="https://go-zero.dev">
<meta itemprop="logo" content="https://go-zero.dev/img/favicon.png">
<meta itemprop="sameAs" content="https://github.com/zeromicro">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light navbar--fixed-top"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="brand_AtiA" href="/cn/"><img alt="logo" height="30" src="/cn/img/navbar/logo.svg" class="brand_logo_MqNk"><a class="navbar__brand brand_name_O39n">go-zero</a></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">文档</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/prepare/prepare">环境准备</a></li><li><a class="dropdown__link" href="/cn/docs/quick-start/quick-start">快速开始</a></li><li><a class="dropdown__link" href="/cn/docs/component/components">组件剖析</a></li><li><a class="dropdown__link" href="/cn/docs/advance/advance">进阶指南</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" sidebarid="goctl">goctl</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/goctl/goctl">安装</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/api">API 指令</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/zrpc">RPC 指令</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/model">Model 指令</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/completion">自动补全</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/tutorial/tutorial">视频教程</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">生态</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/eco/plugins">Goctl 插件</a></li><li><a class="dropdown__link" href="/cn/docs/eco/editor">编辑器插件</a></li><li><a class="dropdown__link" href="/cn/docs/eco/distributed-transaction">分布式事务 (DTM)</a></li><li><a class="dropdown__link" href="/cn/docs/eco/showcase">案例展示</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">社区</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/community/about-us">关于我们</a></li><li><a class="dropdown__link" href="/cn/docs/community/contribute">参与贡献</a></li><li><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub</a></li><li><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord</a></li></ul></div><a class="navbar__item navbar__link" sidebarid="blog" href="/cn/docs/blog/blog">博客</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">更多</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/resource-center/learning-resource">资源中心</a></li><li><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="dropdown__link">视频教程</a></li><li><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="dropdown__link">开发路线图</a></li><li><a class="dropdown__link" href="/cn/docs/design/design">设计文档</a></li><li><a class="dropdown__link" href="/cn/docs/faq/troubleshooting">FAQ</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="searchWrapper_glLF"><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg t="1651714104711" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8547" width="24" height="24" style="vertical-align:text-bottom;margin-right:5px"><path d="M0 0h1024v1024H0z" fill="#FFFFFF" p-id="8548"></path><path d="M785.09056 297.86112l-0.01024-176.40448-253.61408 87.18336 253.62432 89.22112zM499.3024 197.64224L232.58112 102.4v184.1664l266.72128-88.92416zM334.1824 337.37728l44.46208-12.70784v53.97504l95.26272-34.9184v171.4688l-38.11328 12.6976v-25.38496l-63.50848 25.38496 0.27648 95.41632-38.37952 12.55424-0.28672-94.44352-63.21152 24.576 0.01024 19.05664-38.12352 12.6976 0.01024-171.45856 101.60128-31.75424v-57.15968z m101.61152 60.33408l-57.14944 22.2208v63.50848l57.14944-19.05664v-66.67264zM270.68416 521.54368l63.50848-22.23104-0.01024-66.67264-63.49824 22.2208v66.68288z m247.67488-308.40832l-342.9376 117.88288v469.9648l342.9376-114.3296V213.13536z m9.55392 489.41056c-123.38176 41.30816-248.24832 82.5344-371.54816 123.83232l-0.01024-508.0576L804.1472 102.4v202.16832l63.50848 20.10112-0.01024 489.0112-339.73248-111.13472z m266.6496-20.1728c-14.92992-53.98528-29.9008-108.19584-44.9024-162.54976-15.0528-54.49728-30.11584-109.24032-45.2608-164.15744-16.22016-6.28736-32.48128-12.60544-48.81408-18.944-14.85824 43.61216-29.76768 87.36768-44.6976 131.21536l-45.056 132.28032c16.57856 5.96992 33.16736 11.9296 49.68448 17.85856 6.4-20.1728 12.8-40.36608 19.18976-60.54912 30.49472 11.1616 60.9792 22.3232 91.46368 33.47456 6.5024 24.65792 12.99456 49.28512 19.51744 73.8304 16.32256 5.86752 32.63488 11.70432 48.87552 17.54112zM711.30112 535.8592c-10.5472-40.2944-21.10464-80.59904-31.58016-120.90368-10.31168 32.5632-20.60288 65.14688-30.90432 97.73056 20.8384 7.71072 41.65632 15.45216 62.48448 23.17312z m-30.53568 312.10496c-121.21088 75.776-241.60256 85.18656-365.38368 6.51264l-6.62528 10.35264c118.45632 75.264 236.3392 74.07616 357.65248 6.01088 7.10656-4.03456 14.08-8.192 20.992-12.51328L701.44 880.25088l31.87712-58.5728-66.53952 4.42368 13.98784 21.8624z" p-id="8549"></path></svg><span>中文简体</span></span></a><ul class="dropdown__menu"><li><a href="/docs/blog/share/goctl-share-part-one" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/cn/docs/blog/share/goctl-share-part-one" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文简体</a></li></ul></div><a href="https://github.com/zeromicro/go-zero" class="navbar__items navbar__items--right"><img alt="forks" height="30" src="/cn/img/navbar/github-dark.svg" class="star__fork_dBtt"><div class="star_fork_layout_ROo5"><img alt="stars" height="20" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="star__fork_dBtt"><img alt="forks" height="20" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="star__fork_dBtt"></div></a><div class="react-toggle themeToggleInHeading_b3Mq react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_1y7K" style="margin-left:2px"><svg t="1651718448922" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2080" width="200" height="200"><path d="M439.04383639 224.33271976a289.43717504 289.43717504 0 0 0-89.06329676 39.44690807c-27.5075319 18.12412161-51.158867 39.64960558-70.96389486 64.57645191-19.79019562 24.92684633-35.31880082 53.25011237-46.62042137 84.97474006C221.10449032 445.05050411 215.45368042 478.01109252 215.45368042 512c0 40.16870887 7.81621301 78.48347702 23.45358166 115.04318192 15.64725682 36.67341315 36.77228986 68.19039996 63.2910532 94.76354538 26.53359488 26.56820206 58.11485196 47.57952611 94.69927585 63.23667111 36.59431134 15.65714501 75.00301286 23.48324474 115.16183354 23.48324475 33.97407594 0 66.85061917-5.56182137 98.62468557-16.89310498 31.76417894-11.32633953 60.10227581-26.77584294 85.01429133-46.65502781 24.87740834-19.77536407 46.43255539-43.46625042 64.57150781-70.96389488a290.15403174 290.15403174 0 0 0 39.43701989-88.98913905c-8.3056532 0.72180079-17.71378249 1.13213991-28.0958481 1.1321392-45.21637032 0-88.35138342-8.85936294-129.45942212-26.46932463-41.1327577-17.71872658-76.62459295-41.50848964-106.44089858-71.27535655C505.84007277 458.54719011 482.10963587 423.01086095 464.42057238 381.91765379 446.7562286 340.81455917 437.94135957 297.65977044 437.94135957 252.4483442c0-10.40184195 0.39550758-19.77536407 1.15685891-28.01674772l-0.049438-0.09887672zM512.02976157 141.21192041c8.32542811 0 16.51242896 0.31146168 24.6054972 0.92944167-16.4036648 35.32374419-24.60549719 72.09603405-24.60549719 110.30698212 0 35.12104668 6.84227598 68.69961578 20.58121076 100.83458258 13.70927096 32.03114601 32.15474243 59.63261126 55.35124448 82.80933769 23.16683898 23.17178306 50.76830423 41.60736635 82.82416923 55.30674985 32.02125855 13.69938351 65.654209 20.60098567 100.78514387 20.60098568 38.23072298 0 75.03267594-8.24138293 110.35147675-24.62032874 0.59326099 8.14250622 0.86517214 16.28006837 0.86517213 24.62032874 0 33.57856837-4.43956893 66.43533597-13.29893256 98.46648269-8.90880166 32.03114601-21.28817928 61.69419283-37.24195443 88.78149743-15.92411206 27.19112615-35.31880082 52.11797247-58.09013296 74.87941716-22.77627549 22.76144395-47.74267309 42.12152555-74.87447306 58.09013223-27.15157487 15.96366261-56.75529553 28.32326532-88.78644152 37.28644905A368.16784419 368.16784419 0 0 1 512.00009921 882.78807959a368.20739474 368.20739474 0 0 1-98.48625832-13.28904439c-32.03609009-8.95824037-61.6249792-21.31784236-88.79138561-37.28150569-27.12685589-15.96860669-52.08336529-35.32868827-74.89919206-58.09013223-22.7515565-22.76144395-42.13635709-47.68829101-58.05058169-74.87941715-15.96366261-27.0922487-28.34304097-56.75529553-37.2518426-88.78149744A367.9354836 367.9354836 0 0 1 141.21201889 512c0-33.57856837 4.4494571-66.43533597 13.30882004-98.46648269 8.90880166-32.03114601 21.28817928-61.69419283 37.25184259-88.78149744 15.91916798-27.19112615 35.29902519-52.11797247 58.0505817-74.87941715 22.81582676-22.86526476 47.77233617-42.22534634 74.89919206-58.09013223C351.89380578 175.81880789 381.4826949 163.36032846 413.51878498 154.50096479A368.20739474 368.20739474 0 0 1 512.00009921 141.21192041h0.02966236z" p-id="2081" fill="#ffffff"></path></svg></span></div><div class="react-toggle-track-x"><span class="toggle_1y7K" style="margin-left:1px"><svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1940" width="25" height="25"><path d="M752.41931153 240.7063601c8.36993432 0 15.62255883 3.08990502 21.72821045 9.16589356 6.1353147 6.08093262 9.18566918 13.3928833 9.18566918 21.73315382 0 8.55285621-3.05035376 15.85986352-9.18566918 21.94079614l-43.67394996 43.66900658c-5.93261719 5.97216773-13.17041016 8.95825195-21.72326709 8.95825195-8.87420678 0-16.20098901-2.98608422-22.08911085-8.75061035-5.88317847-5.87329102-8.80004906-13.2890625-8.80004906-22.14843774 0-8.54791283 2.95642114-15.75604272 8.91375732-21.72821044l43.66900659-43.67394996c6.14025879-6.07598853 13.44726539-9.16589356 21.98034668-9.16589356z m37.66223167 240.39459181h61.79809547c8.52813721 0 15.82031227 2.98608422 21.83697534 9.06207276C879.78271508 496.24395728 882.78857422 503.45208717 882.78857422 512c0 8.55285621-3.00585914 15.85986352-9.07196021 21.83697533-6.01666236 6.07598853-13.30883813 9.06207276-21.83697534 9.06207276h-61.79809547c-8.52813721 0-15.80053734-2.98608422-21.86663841-9.06207276-6.01666236-5.97711182-9.05712867-13.2890625-9.05712867-21.83697533 0-8.55285621 3.04046631-15.76098609 9.05712867-21.83697533 6.06610107-6.07598853 13.33850122-9.06207276 21.86663841-9.06207276zM512 141.21142578c8.52813721 0 15.79064917 3.08990502 21.85180688 9.06207276 6.02160645 6.08093262 9.05712867 13.3928833 9.05712867 21.83697533v61.79809546c0 8.55285621-3.03552222 15.85986352-9.0521853 21.83697534-6.06610107 6.07598853-13.32861305 9.16589356-21.85675025 9.16589355-8.53802467 0-15.80053734-3.08990502-21.86663842-9.16589355-6.01666236-5.97711182-9.0521853-13.2890625-9.05218458-21.83697534V172.11047387c0-8.44409203 3.03552222-15.76098609 9.05218458-21.83697533C496.20440674 144.3013308 503.46691871 141.21142578 512.00494408 141.21142578zM271.81304907 240.7063601c8.36499023 0 15.61267066 3.08990502 21.743042 9.16589356l43.66900659 43.67394996c6.14025879 6.07598853 9.17083764 13.38793922 9.17083764 21.72821044 0 8.55285621-3.01080323 15.86480689-9.05712938 21.83697534-6.03149391 6.08093262-13.30389404 9.06207276-21.85180617 9.06207275-8.69622827 0-16.02795386-2.98608422-21.95068359-8.85443115l-43.68383814-43.67395068c-5.97216773-5.97216773-8.92858886-13.28411842-8.92858886-22.03967284 0-8.55285621 3.00585914-15.76098609 9.07196021-21.83697462 6.01666236-5.97216773 13.30883813-9.06207276 21.85675096-9.06207276h-0.03955126z m436.93725586 436.91253615c8.36499023 0 15.60772729 2.98608422 21.72326709 9.16589355l43.67394995 43.67395067c6.1353147 6.17980933 9.18566918 13.38793922 9.18566919 21.93585205 0 8.34521461-3.05035376 15.65716529-9.18566919 21.73315382-6.1105957 6.17980933-13.35827613 9.16589356-21.72326636 9.16589356-8.52813721 0-15.84008789-2.98608422-21.98034668-9.16589356l-43.66900659-43.66900587c-5.95733618-5.87329102-8.91375732-13.1852417-8.91375732-21.73315453 0-8.55285621 3.01080323-15.86480689 9.05712866-21.94079614 6.03149391-6.07598853 13.32861305-9.16589356 21.85180689-9.16589355h-0.01977564zM512.00494408 388.40380836c-34.12243628 0-63.22192359 12.05310035-87.39239525 36.2532351-24.1358645 24.10125732-36.21368384 53.25018335-36.21368384 87.34295654 0 34.0927732 12.07782007 63.24169922 36.21368384 87.44677734C448.78796387 623.53814721 477.88250709 635.59619164 512 635.59619164c34.12243628 0 63.23181176-12.05310035 87.4072268-36.15435838C623.51837158 575.2466433 635.59619164 546.09771729 635.59619164 512c0-34.0927732-12.07782007-63.24169922-36.18896484-87.34295654C575.23181176 400.45690942 546.12243628 388.40380836 512 388.40380836zM172.12036133 481.10095191h61.79809547c8.53802467 0 15.80053734 2.98608422 21.86663841 9.06207276 6.01666236 6.08093262 9.05712867 13.2890625 9.05712867 21.83697533 0 8.55285621-3.04046631 15.85986352-9.05712867 21.83697533-6.06610107 6.07598853-13.32861305 9.06207276-21.86663841 9.06207276h-61.79809547c-8.52813721 0-15.81042481-2.98608422-21.83697534-9.06207276C144.21728492 527.85986352 141.21142578 520.54791283 141.21142578 512c0-8.55285621 3.00585914-15.76098609 9.07196021-21.83697533 6.03149391-6.07598853 13.30883813-9.06207276 21.83697534-9.06207276zM512.00494408 759.19238258c8.52813721 0 15.79064917 2.98608422 21.85180617 9.06207274 6.02160645 6.08093262 9.05712867 13.2890625 9.05712938 21.83697535v61.79809546c0 8.55285621-3.03552222 15.85986352-9.0521853 21.83697533C527.79559326 879.80249 520.53308129 882.78857422 512 882.78857422c-8.53802467 0-15.80053734-2.98608422-21.86663842-9.06207276-6.01666236-5.97711182-9.0521853-13.2890625-9.05218458-21.83697533v-61.79809546c0-8.55285621 3.03552222-15.76098609 9.05218458-21.83697534 6.06610107-6.07598853 13.32861305-9.06207276 21.86663842-9.06207275z m-196.47839379-81.57348633c8.5034182 0 15.80053734 2.98608422 21.84686279 9.16589355 6.03149391 6.08093262 9.07196021 13.3928833 9.07196021 21.94079614 0 8.44409203-3.08001685 15.65222192-9.19555664 21.72821044l-43.67394995 43.67394996c-6.10565162 6.17980933-13.34838867 9.16589356-21.72326637 9.16589356-8.54791283 0-15.84008789-2.98608422-21.85180687-8.96319533-6.07104516-6.07598853-9.0769043-13.38793922-9.0769043-21.93585205 0-8.65173364 2.95642114-15.96862769 8.92858887-21.94079614l43.68383813-43.66900658c6.10565162-6.17980933 13.44232202-9.16589356 21.95068359-9.16589355h0.03955054zM512 326.60571289c33.628052 0 64.6506958 8.34521461 93.0481565 24.81811547 28.42712378 16.69042992 50.92163109 39.1404419 67.4637456 67.56756568 16.57177758 28.32824708 24.86755347 59.32617188 24.86755347 93.00860596 0 33.68243408-8.27600098 64.68035888-24.86755347 93.10748267-16.58166504 28.32824708-39.08605981 50.77825904-67.4637456 67.4637456-28.36285424 16.58166504-59.37561059 24.82305884-93.0481565 24.82305884-33.66760254 0-64.67047143-8.24139381-93.05804468-24.81811547-28.37768578-16.69042992-50.86230492-39.14538598-67.46374487-67.46868897-16.58166504-28.42712378-24.86755347-59.42504859-24.86755348-93.10748267 0-33.68243408 8.31555152-64.68035888 24.86755348-93.00860596 16.55200195-28.42712378 39.03662109-50.87713647 67.46374487-67.56262231C447.35424828 334.94598413 478.371948 326.60571289 512 326.60571289z" p-id="1941"></path></svg></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/cn/">go-zero</a><div class="react-toggle themeToggleInSidebar_qGRI react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_1y7K" style="margin-left:2px"><svg t="1651718448922" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2080" width="200" height="200"><path d="M439.04383639 224.33271976a289.43717504 289.43717504 0 0 0-89.06329676 39.44690807c-27.5075319 18.12412161-51.158867 39.64960558-70.96389486 64.57645191-19.79019562 24.92684633-35.31880082 53.25011237-46.62042137 84.97474006C221.10449032 445.05050411 215.45368042 478.01109252 215.45368042 512c0 40.16870887 7.81621301 78.48347702 23.45358166 115.04318192 15.64725682 36.67341315 36.77228986 68.19039996 63.2910532 94.76354538 26.53359488 26.56820206 58.11485196 47.57952611 94.69927585 63.23667111 36.59431134 15.65714501 75.00301286 23.48324474 115.16183354 23.48324475 33.97407594 0 66.85061917-5.56182137 98.62468557-16.89310498 31.76417894-11.32633953 60.10227581-26.77584294 85.01429133-46.65502781 24.87740834-19.77536407 46.43255539-43.46625042 64.57150781-70.96389488a290.15403174 290.15403174 0 0 0 39.43701989-88.98913905c-8.3056532 0.72180079-17.71378249 1.13213991-28.0958481 1.1321392-45.21637032 0-88.35138342-8.85936294-129.45942212-26.46932463-41.1327577-17.71872658-76.62459295-41.50848964-106.44089858-71.27535655C505.84007277 458.54719011 482.10963587 423.01086095 464.42057238 381.91765379 446.7562286 340.81455917 437.94135957 297.65977044 437.94135957 252.4483442c0-10.40184195 0.39550758-19.77536407 1.15685891-28.01674772l-0.049438-0.09887672zM512.02976157 141.21192041c8.32542811 0 16.51242896 0.31146168 24.6054972 0.92944167-16.4036648 35.32374419-24.60549719 72.09603405-24.60549719 110.30698212 0 35.12104668 6.84227598 68.69961578 20.58121076 100.83458258 13.70927096 32.03114601 32.15474243 59.63261126 55.35124448 82.80933769 23.16683898 23.17178306 50.76830423 41.60736635 82.82416923 55.30674985 32.02125855 13.69938351 65.654209 20.60098567 100.78514387 20.60098568 38.23072298 0 75.03267594-8.24138293 110.35147675-24.62032874 0.59326099 8.14250622 0.86517214 16.28006837 0.86517213 24.62032874 0 33.57856837-4.43956893 66.43533597-13.29893256 98.46648269-8.90880166 32.03114601-21.28817928 61.69419283-37.24195443 88.78149743-15.92411206 27.19112615-35.31880082 52.11797247-58.09013296 74.87941716-22.77627549 22.76144395-47.74267309 42.12152555-74.87447306 58.09013223-27.15157487 15.96366261-56.75529553 28.32326532-88.78644152 37.28644905A368.16784419 368.16784419 0 0 1 512.00009921 882.78807959a368.20739474 368.20739474 0 0 1-98.48625832-13.28904439c-32.03609009-8.95824037-61.6249792-21.31784236-88.79138561-37.28150569-27.12685589-15.96860669-52.08336529-35.32868827-74.89919206-58.09013223-22.7515565-22.76144395-42.13635709-47.68829101-58.05058169-74.87941715-15.96366261-27.0922487-28.34304097-56.75529553-37.2518426-88.78149744A367.9354836 367.9354836 0 0 1 141.21201889 512c0-33.57856837 4.4494571-66.43533597 13.30882004-98.46648269 8.90880166-32.03114601 21.28817928-61.69419283 37.25184259-88.78149744 15.91916798-27.19112615 35.29902519-52.11797247 58.0505817-74.87941715 22.81582676-22.86526476 47.77233617-42.22534634 74.89919206-58.09013223C351.89380578 175.81880789 381.4826949 163.36032846 413.51878498 154.50096479A368.20739474 368.20739474 0 0 1 512.00009921 141.21192041h0.02966236z" p-id="2081" fill="#ffffff"></path></svg></span></div><div class="react-toggle-track-x"><span class="toggle_1y7K" style="margin-left:1px"><svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1940" width="25" height="25"><path d="M752.41931153 240.7063601c8.36993432 0 15.62255883 3.08990502 21.72821045 9.16589356 6.1353147 6.08093262 9.18566918 13.3928833 9.18566918 21.73315382 0 8.55285621-3.05035376 15.85986352-9.18566918 21.94079614l-43.67394996 43.66900658c-5.93261719 5.97216773-13.17041016 8.95825195-21.72326709 8.95825195-8.87420678 0-16.20098901-2.98608422-22.08911085-8.75061035-5.88317847-5.87329102-8.80004906-13.2890625-8.80004906-22.14843774 0-8.54791283 2.95642114-15.75604272 8.91375732-21.72821044l43.66900659-43.67394996c6.14025879-6.07598853 13.44726539-9.16589356 21.98034668-9.16589356z m37.66223167 240.39459181h61.79809547c8.52813721 0 15.82031227 2.98608422 21.83697534 9.06207276C879.78271508 496.24395728 882.78857422 503.45208717 882.78857422 512c0 8.55285621-3.00585914 15.85986352-9.07196021 21.83697533-6.01666236 6.07598853-13.30883813 9.06207276-21.83697534 9.06207276h-61.79809547c-8.52813721 0-15.80053734-2.98608422-21.86663841-9.06207276-6.01666236-5.97711182-9.05712867-13.2890625-9.05712867-21.83697533 0-8.55285621 3.04046631-15.76098609 9.05712867-21.83697533 6.06610107-6.07598853 13.33850122-9.06207276 21.86663841-9.06207276zM512 141.21142578c8.52813721 0 15.79064917 3.08990502 21.85180688 9.06207276 6.02160645 6.08093262 9.05712867 13.3928833 9.05712867 21.83697533v61.79809546c0 8.55285621-3.03552222 15.85986352-9.0521853 21.83697534-6.06610107 6.07598853-13.32861305 9.16589356-21.85675025 9.16589355-8.53802467 0-15.80053734-3.08990502-21.86663842-9.16589355-6.01666236-5.97711182-9.0521853-13.2890625-9.05218458-21.83697534V172.11047387c0-8.44409203 3.03552222-15.76098609 9.05218458-21.83697533C496.20440674 144.3013308 503.46691871 141.21142578 512.00494408 141.21142578zM271.81304907 240.7063601c8.36499023 0 15.61267066 3.08990502 21.743042 9.16589356l43.66900659 43.67394996c6.14025879 6.07598853 9.17083764 13.38793922 9.17083764 21.72821044 0 8.55285621-3.01080323 15.86480689-9.05712938 21.83697534-6.03149391 6.08093262-13.30389404 9.06207276-21.85180617 9.06207275-8.69622827 0-16.02795386-2.98608422-21.95068359-8.85443115l-43.68383814-43.67395068c-5.97216773-5.97216773-8.92858886-13.28411842-8.92858886-22.03967284 0-8.55285621 3.00585914-15.76098609 9.07196021-21.83697462 6.01666236-5.97216773 13.30883813-9.06207276 21.85675096-9.06207276h-0.03955126z m436.93725586 436.91253615c8.36499023 0 15.60772729 2.98608422 21.72326709 9.16589355l43.67394995 43.67395067c6.1353147 6.17980933 9.18566918 13.38793922 9.18566919 21.93585205 0 8.34521461-3.05035376 15.65716529-9.18566919 21.73315382-6.1105957 6.17980933-13.35827613 9.16589356-21.72326636 9.16589356-8.52813721 0-15.84008789-2.98608422-21.98034668-9.16589356l-43.66900659-43.66900587c-5.95733618-5.87329102-8.91375732-13.1852417-8.91375732-21.73315453 0-8.55285621 3.01080323-15.86480689 9.05712866-21.94079614 6.03149391-6.07598853 13.32861305-9.16589356 21.85180689-9.16589355h-0.01977564zM512.00494408 388.40380836c-34.12243628 0-63.22192359 12.05310035-87.39239525 36.2532351-24.1358645 24.10125732-36.21368384 53.25018335-36.21368384 87.34295654 0 34.0927732 12.07782007 63.24169922 36.21368384 87.44677734C448.78796387 623.53814721 477.88250709 635.59619164 512 635.59619164c34.12243628 0 63.23181176-12.05310035 87.4072268-36.15435838C623.51837158 575.2466433 635.59619164 546.09771729 635.59619164 512c0-34.0927732-12.07782007-63.24169922-36.18896484-87.34295654C575.23181176 400.45690942 546.12243628 388.40380836 512 388.40380836zM172.12036133 481.10095191h61.79809547c8.53802467 0 15.80053734 2.98608422 21.86663841 9.06207276 6.01666236 6.08093262 9.05712867 13.2890625 9.05712867 21.83697533 0 8.55285621-3.04046631 15.85986352-9.05712867 21.83697533-6.06610107 6.07598853-13.32861305 9.06207276-21.86663841 9.06207276h-61.79809547c-8.52813721 0-15.81042481-2.98608422-21.83697534-9.06207276C144.21728492 527.85986352 141.21142578 520.54791283 141.21142578 512c0-8.55285621 3.00585914-15.76098609 9.07196021-21.83697533 6.03149391-6.07598853 13.30883813-9.06207276 21.83697534-9.06207276zM512.00494408 759.19238258c8.52813721 0 15.79064917 2.98608422 21.85180617 9.06207274 6.02160645 6.08093262 9.05712867 13.2890625 9.05712938 21.83697535v61.79809546c0 8.55285621-3.03552222 15.85986352-9.0521853 21.83697533C527.79559326 879.80249 520.53308129 882.78857422 512 882.78857422c-8.53802467 0-15.80053734-2.98608422-21.86663842-9.06207276-6.01666236-5.97711182-9.0521853-13.2890625-9.05218458-21.83697533v-61.79809546c0-8.55285621 3.03552222-15.76098609 9.05218458-21.83697534 6.06610107-6.07598853 13.32861305-9.06207276 21.86663842-9.06207275z m-196.47839379-81.57348633c8.5034182 0 15.80053734 2.98608422 21.84686279 9.16589355 6.03149391 6.08093262 9.07196021 13.3928833 9.07196021 21.94079614 0 8.44409203-3.08001685 15.65222192-9.19555664 21.72821044l-43.67394995 43.67394996c-6.10565162 6.17980933-13.34838867 9.16589356-21.72326637 9.16589356-8.54791283 0-15.84008789-2.98608422-21.85180687-8.96319533-6.07104516-6.07598853-9.0769043-13.38793922-9.0769043-21.93585205 0-8.65173364 2.95642114-15.96862769 8.92858887-21.94079614l43.68383813-43.66900658c6.10565162-6.17980933 13.44232202-9.16589356 21.95068359-9.16589355h0.03955054zM512 326.60571289c33.628052 0 64.6506958 8.34521461 93.0481565 24.81811547 28.42712378 16.69042992 50.92163109 39.1404419 67.4637456 67.56756568 16.57177758 28.32824708 24.86755347 59.32617188 24.86755347 93.00860596 0 33.68243408-8.27600098 64.68035888-24.86755347 93.10748267-16.58166504 28.32824708-39.08605981 50.77825904-67.4637456 67.4637456-28.36285424 16.58166504-59.37561059 24.82305884-93.0481565 24.82305884-33.66760254 0-64.67047143-8.24139381-93.05804468-24.81811547-28.37768578-16.69042992-50.86230492-39.14538598-67.46374487-67.46868897-16.58166504-28.42712378-24.86755347-59.42504859-24.86755348-93.10748267 0-33.68243408 8.31555152-64.68035888 24.86755348-93.00860596 16.55200195-28.42712378 39.03662109-50.87713647 67.46374487-67.56262231C447.35424828 334.94598413 478.371948 326.60571289 512 326.60571289z" p-id="1941"></path></svg></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg t="1651714104711" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8547" width="24" height="24" style="vertical-align:text-bottom;margin-right:5px"><path d="M0 0h1024v1024H0z" fill="#FFFFFF" p-id="8548"></path><path d="M785.09056 297.86112l-0.01024-176.40448-253.61408 87.18336 253.62432 89.22112zM499.3024 197.64224L232.58112 102.4v184.1664l266.72128-88.92416zM334.1824 337.37728l44.46208-12.70784v53.97504l95.26272-34.9184v171.4688l-38.11328 12.6976v-25.38496l-63.50848 25.38496 0.27648 95.41632-38.37952 12.55424-0.28672-94.44352-63.21152 24.576 0.01024 19.05664-38.12352 12.6976 0.01024-171.45856 101.60128-31.75424v-57.15968z m101.61152 60.33408l-57.14944 22.2208v63.50848l57.14944-19.05664v-66.67264zM270.68416 521.54368l63.50848-22.23104-0.01024-66.67264-63.49824 22.2208v66.68288z m247.67488-308.40832l-342.9376 117.88288v469.9648l342.9376-114.3296V213.13536z m9.55392 489.41056c-123.38176 41.30816-248.24832 82.5344-371.54816 123.83232l-0.01024-508.0576L804.1472 102.4v202.16832l63.50848 20.10112-0.01024 489.0112-339.73248-111.13472z m266.6496-20.1728c-14.92992-53.98528-29.9008-108.19584-44.9024-162.54976-15.0528-54.49728-30.11584-109.24032-45.2608-164.15744-16.22016-6.28736-32.48128-12.60544-48.81408-18.944-14.85824 43.61216-29.76768 87.36768-44.6976 131.21536l-45.056 132.28032c16.57856 5.96992 33.16736 11.9296 49.68448 17.85856 6.4-20.1728 12.8-40.36608 19.18976-60.54912 30.49472 11.1616 60.9792 22.3232 91.46368 33.47456 6.5024 24.65792 12.99456 49.28512 19.51744 73.8304 16.32256 5.86752 32.63488 11.70432 48.87552 17.54112zM711.30112 535.8592c-10.5472-40.2944-21.10464-80.59904-31.58016-120.90368-10.31168 32.5632-20.60288 65.14688-30.90432 97.73056 20.8384 7.71072 41.65632 15.45216 62.48448 23.17312z m-30.53568 312.10496c-121.21088 75.776-241.60256 85.18656-365.38368 6.51264l-6.62528 10.35264c118.45632 75.264 236.3392 74.07616 357.65248 6.01088 7.10656-4.03456 14.08-8.192 20.992-12.51328L701.44 880.25088l31.87712-58.5728-66.53952 4.42368 13.98784 21.8624z" p-id="8549"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/docs/blog/share/goctl-share-part-one" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/cn/docs/blog/share/goctl-share-part-one" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">中文简体</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">文档</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/prepare/prepare">环境准备</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/quick-start/quick-start">快速开始</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/component/components">组件剖析</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/advance/advance">进阶指南</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist" sidebarid="goctl">goctl</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/goctl">安装</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/api">API 指令</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/zrpc">RPC 指令</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/model">Model 指令</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/completion">自动补全</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/tutorial/tutorial">视频教程</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">生态</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/eco/plugins">Goctl 插件</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/eco/editor">编辑器插件</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/eco/distributed-transaction">分布式事务 (DTM)</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/eco/showcase">案例展示</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">社区</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/community/about-us">关于我们</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/community/contribute">参与贡献</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="menu__link">Discord</a></li></ul></li><li class="menu__list-item"><a class="menu__link" sidebarid="blog" href="/cn/docs/blog/blog">博客</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">更多</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/resource-center/learning-resource">资源中心</a></li><li class="menu__list-item"><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="menu__link">视频教程</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="menu__link">开发路线图</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/design/design">设计文档</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/faq/troubleshooting">FAQ</a></li></ul></li></ul></div></div></div></nav><div class="wrapper_DIJ0"><div class="doc_D+rh"><div class="doc__sidebar_gVFN" role="complementary"><div class="sidebar_LIo8"><div class="menu menu--responsive thin-scrollbar menu_oAhv"><button aria-label="打开" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_nrF-" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" href="/cn/docs/blog/blog">博客</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">服务治理</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/bloom">bloom</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/breaker-algorithms">熔断原理与实现</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/loadshedding">服务自适应降载保护设计</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/periodlimit">periodlimit</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/tokenlimit">tokenlimit</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">缓存设计</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/cache">DB缓存机制</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/redis-cache">go-zero缓存设计之持久层缓存</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/business-cache">go-zero缓存设计之业务层缓存</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/collection">通过 collection.Cache 进行缓存</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">组件介绍</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/tool/executors">executors</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/tool/keywords">高效的关键词替换和敏感词过滤工具</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/tool/logx">logx</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">并发编程</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/fx">fx</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/mapreduce">通过MapReduce降低服务响应时间</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/stream">流数据处理利器</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/redis-lock">redis lock</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/sharedcalls">防止缓存击穿之进程内共享调用</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">原理介绍</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/principle/timing-wheel">TimingWheel</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">案例展示</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/showcase/shorturl">快速构建高并发微服务</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/showcase/zrpc">企业级RPC框架zRPC</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/showcase/mysql">mysql</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/showcase/mapping">文本序列化和反序列化</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/showcase/datacenter">我是如何用 go-zero 实现一个中台系统</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/showcase/go-queue">go-zero 分布式定时任务</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/showcase/go-zero-looklook">使用go-zero开发一个旅游系统go-zero-looklook</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/showcase/metric">基于prometheus的微服务指标监控</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u menu__link--sublist menu__link--active" href="#!">线上交流</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/share/online-exchange">10月3日线上交流问题汇总</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menuLink_Zq3u menu__link--active active" tabindex="0" href="/cn/docs/blog/share/goctl-share-part-one">goctl 效能工具深度解析（一）</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/share/goctl-share-part-two">goctl 效能工具深度解析（二）</a></li></ul></li></ul></div></div></div><main class="doc__main_VklL"><div class="padding-vert--lg container doc__item-wrapper_FIxd"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">goctl 效能工具深度解析（一）</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1-goctl-的诞生"></a>1. goctl 的诞生<a class="hash-link" href="#1-goctl-的诞生" title="跳转到标题">#</a></h2><p>  goctl 的最早功能是为了解决 GRPC 内网调试问题，大约是在 2019 年，在我们的生产环境中，rpc 是内网隔离的，不可通过外网访问，为了快速去 mock 一些线上 RPC client 的请求，就简单的实现了第一版本的代码生成，主要目的是去访问 RPC Server 做一些调试。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="2-为什么需要-goctl"></a>2. 为什么需要 goctl？<a class="hash-link" href="#2-为什么需要-goctl" title="跳转到标题">#</a></h2><ul><li><p>降低沟通成本</p><p>沟通，是团队协作进行信息交换的一种形式，沟通的方式有很多种，会议沟通、文档沟通、聊天交流，相信不管是哪种方式，沟通都是团队中最难的一个环节，会议沟通需要占用大量时间，动则半小时起步，文档沟通同样，也会占据大量时间去构思和编写大篇幅的文档，最后可能还没表达出预期目标，线上聊天，需要双方都在线上才能进行信息交换，当然我们这里沟通交换的信息更多是指开发中的一些内容，如接口信息、部署信息等。</p></li><li><p>降低团队耦合</p><p>有了沟通，那么团队之间的协作的耦合是避免不了的，例如：在前后端开发中，最大的耦合是接口的耦合，前端完成了规定 UI 绘制后，需要等待后端的接口部署到对应环境才能实现功能的调试，在此期间，前端的团队资源就会大大浪费，由此还会导致项目的延期等问题。</p></li><li><p>提高开发效率</p><p>除了沟通成本和团队耦合以外，每个团队在进行项目开发时也有很多时间是在做重复的工作，例如：我们在开发一个新的功能时，需要去定义接口，编写接口文档，编码准备工作，业务开发，model 文件，编写 Dockerfile 文件，编写 k8s yaml 文件，在这些上面我们可以在每个环节上都有提升的空间，让用户将真正的时间集中在业务开发上。</p></li><li><p>降低错误率</p><p>在之前的开发实践中，经常会出现 grpc server 实现不完全的问题，grpc server 实现类经常会出现编译不过的情况；除此之外，数据库查询层代码开发，sql 语句的编写多参，少参，参数错位，在编译过程中很难发现，一般可能到 QA 环节才能发现，更甚者会导致线上问题。</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="3-怎么理解开发规范"></a>3. 怎么理解开发规范？<a class="hash-link" href="#3-怎么理解开发规范" title="跳转到标题">#</a></h2><p>  开发规范，包括编码规范，工程规范，提交规范，代码审核规范，部署规范等等，团队内如果将开发规范统一起来，其收益可想而知，举个例子：假如你所在的公司没有统一开发规范，这时需要你去做一些跨部门协作或者支持，焕然一新的开发环境让你望而却步，还没开始就有了抵触的念头，这岂不是违背了支持的初衷。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="4-怎么理解工程效率"></a>4. 怎么理解工程效率？<a class="hash-link" href="#4-怎么理解工程效率" title="跳转到标题">#</a></h2><p>  工程效率，要理解工程效率，可以先看看『效率』的定义：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><div tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">效率是指单位时间内完成的工作量</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>  效率的目标是快，但快并不是效率，换句话说就是在单位时间内完成的高质量工作，这才是我们要追求的目标，那么工程效率就是为了『缩短从开发到线上的距离』</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="二-goctl-的安装及功能介绍"></a>二 、goctl 的安装及功能介绍<a class="hash-link" href="#二-goctl-的安装及功能介绍" title="跳转到标题">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1-介绍"></a>1. 介绍<a class="hash-link" href="#1-介绍" title="跳转到标题">#</a></h2><ul><li><p>goctl 定义</p><blockquote><p>goctl 定义，准确说是定位吧，可以理解为一个代码生成脚手架，其核心思想是通过对 DSL 进行语法解析、语义分析到数据驱动实现完成代码生成功能，旨在帮助开发者从工程效率角度提高开发者的开发效率。</p></blockquote></li><li><p>解决的问题</p><ul><li>提高开发效率：goctl 的代码生成覆盖了 Go、Java、Android、iOS、TS 等多门语言，通过 goctl 可以一键生成各端代码，让开发者将精力集中在业务开发上。</li><li>降低沟通成本：使用 zero-api 替代 API 文档，各端以 zero-api 为中心生成各端代码，无需要在通过会议、API 文档来进行接口信息传递。</li><li>降低耦合度：在之前的开发时间中，没有 goctl 之前，我们采用的是传统的 API 文档来作为接口信息传递的载体，然后通过会议来进行二次 review，我们都知道，前端开发工作中，除了 UI 的绘制外就是 UI 联调，如果是比较积极的前端开发者，可能会自己利用一些脚手架或者自己 mock 一些数据去进行 UI 联调，反之，也有原地等待后端部署后再联调的 case，原因是自己写 mock 数据太耗时，也不想去动，如果前端的开发进度在后端之前，那么在后端部署到环境中这期间，前端只能安静的原地等待，这不仅是一种资源的浪费，也会造成项目进度的延期，有了 zero-api ，前端可以利用 goctl 去生成适量的 mock 数据来进行 UI 联调。</li></ul></li><li><p>发展历史
<img alt="goctl-history" src="/cn/assets/images/goctl-history-6b530a25fd4f4227aad1dc55f218c7b7.svg"></p><p> goctl 发展历史可以大概的过一下，挑几个标志性的功能讲讲吧！
首先是 goctl rpc，goctl rpc 的第一版本就是 goctl 的雏形，主要是为了生成 client 代码对 rpc 做调试使用，具体就不展开了。goctl rpc 的发展经过了很多曲折，印象比较深刻的应该算 goctl rpc proto 向 goctl rpc protoc 的转变，这期间为了解决很多问题，才做了相应的变更，具体细节在分享 rpc 代码生成使用那块再详细分享，在这里面其实对我来说印象最深刻的一个功能算是 goctl model 了，其算是我开始维护 goctl 的一个入手点吧，也是我从业务开发实践中挖掘的解决方案吧，终究我还是比较“懒”，记得在当时开发一个业务模块，由于业务比较大，需要创建的数据表也很多，在没有 goctl 前都是自己去手动编码完成，这一块我记忆犹新，花了仅一天的时间来写 model 文件，因为我没有用 orm 的习惯，所以这块 sql 完全是裸 sql 语句，服务跑起来后才发现有很多 sql 传参上的错误，基本都是多参少参问题，除此之外，每次新增索引，或者字段变更，缓存的相关逻辑维护也让我十分头疼，于是结合当时的开发最佳实践，将其按照缓存与否把这块的工作交给了 goctl，第一版本 goctl model 生成主要是网页版本，后面陆续集成到 goctl 里了，这给我后续开发带来了很大的开发效率收益。
</p></li><li><p>展望未来</p><p>goctl 集成了比较多的功能，其基本是以代码生成为主，开发规范为辅，goctl 是围绕 zero-api 为中心做代码生成的，因此在将来，zero-api 的建设会成为我们的重心：</p><ul><li>ast 的改造：替换原有比较重的 antlr4，可以解决很多人在安装 goctl 时的内存不够、系统架构不支持等各种问题</li><li>goctl mock 的支持，最大限度解耦各端依赖耦合</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="2-安装"></a>2. 安装<a class="hash-link" href="#2-安装" title="跳转到标题">#</a></h2><p>   Goctl 安装有两种方式，分别是 go get 或者 go install，其次是 docker。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="go-getinstall"></a>go get/install<a class="hash-link" href="#go-getinstall" title="跳转到标题">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># Go 1.16 之前版本</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># $ GO111MODULE=on GOPROXY=https://goproxy.cn/,direct go get -u github.com/zeromicro/go-zero/tools/goctl@latest</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># Go 1.16 及以后版本</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token assign-left variable" style="color:#ff79c6">GOPROXY</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">https://goproxy.cn/,direct go </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> github.com/zeromicro/go-zero/tools/goctl@latest</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># macOS</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># $ brew install goctl</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 验证</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl --version</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl version </span><span class="token number" style="color:#50fa7b">1.3</span><span class="token plain">.6-beta darwin/amd64</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 查看 goctl</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:#bd93f9">cd</span><span class="token plain"> </span><span class="token variable" style="color:#ff79c6">$GOPATH</span><span class="token plain">/bin </span><span class="token operator" style="color:#ff79c6">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">ls</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">grep</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;goctl&quot;</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>如果执行 goctl --version 提示 command not found: goctl 的错误，请先排查 $GOBIN 是否在环境变量下。</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="docker"></a>docker<a class="hash-link" href="#docker" title="跳转到标题">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># 1. pull</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token function" style="color:#8be9fd">docker</span><span class="token plain"> pull kevinwan/goctl</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">..</span><span class="token punctuation" style="color:#f8f8f2">..</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 2. ls</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token function" style="color:#8be9fd">docker</span><span class="token plain"> image </span><span class="token function" style="color:#8be9fd">ls</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">grep</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;goctl&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">kevinwan/goctl        latest    7fd46843de3d   </span><span class="token number" style="color:#50fa7b">5</span><span class="token plain"> weeks ago    383MB</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 3. run</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token function" style="color:#8be9fd">docker</span><span class="token plain"> run -it kevinwan/goctl /bin/sh</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="3-功能介绍"></a>3. 功能介绍<a class="hash-link" href="#3-功能介绍" title="跳转到标题">#</a></h2><p>   我们接下来看看功能介绍，通过指令 goctl --help 可以列出我们当前已经支持的功能，可能大家在看文档时也没有专心下来对这块指令做研究，只是用到一些高频指令，今天既然是 goctl 的专题分享，我们就花点时间来一起过过，带着大家从 0 到 1 熟悉 goctl。</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl --help                                                       </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">A cli tool to generate api, zrpc, model code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Usage:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">command</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Available Commands:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">api         Generate api related files</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">bug         Report a bug</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">completion  Generate the autocompletion script </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> the specified shell</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">docker</span><span class="token plain">      Generate Dockerfile</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">env</span><span class="token plain">         Check or edit goctl environment</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">help</span><span class="token plain">        Help about any </span><span class="token builtin class-name" style="color:#bd93f9">command</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">kube        Generate kubernetes files</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">migrate     Migrate from tal-tech to zeromicro</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">model       Generate model code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">quickstart  quickly start a project</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">rpc         Generate rpc code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">template    Template operation</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">upgrade     Upgrade goctl to latest version</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Flags:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-h, --help      </span><span class="token builtin class-name" style="color:#bd93f9">help</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> goctl</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-v, --version   version </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> goctl</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Use </span><span class="token string" style="color:#f1fa8c">&quot;goctl [command] --help&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">more</span><span class="token plain"> information about a command.</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>goctl 的功能比较丰富，所以难免指令参数比较多，大家在使用时除了看文档外，也善用 --help 这个 flag，因为他会告诉你每个指令或者子指令的用法，需要什么参数，参数类型是字符串还是布尔，是必填还是可选，切不可自己猜测他应该用什么 flag，虽然 goctl 是我自己主要维护，其实很多时候，有些指令比较文档，没有太多 feature 去更新，我也记不住，我也是通过 --help 去查看功能介绍的</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="重点演示"></a>重点演示<a class="hash-link" href="#重点演示" title="跳转到标题">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="goctl-completion"></a>goctl completion<a class="hash-link" href="#goctl-completion" title="跳转到标题">#</a></h4><p>查看 goctl 版本</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl --version</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl version </span><span class="token number" style="color:#50fa7b">1.3</span><span class="token plain">.5 darwin/amd64</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="135"></a>1.3.5<a class="hash-link" href="#135" title="跳转到标题">#</a></h5><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>本节内容仅适合 goctl 版本在 1.3.5 及之前的的自动补全设置参考，1.3.5 版本及之前仅支持类 Unix 操作系统，不支持 Windows 的自动补全，1.3.5 之后的请跳过此节内容</p></div></div><ol><li>执行 goctl completion -h 查看使用说明</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl completion --help                                </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">   NAME:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">   goctl completion - generation completion script, it only works </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> unix-like OS</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">USAGE:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl completion </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">command options</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">arguments</span><span class="token punctuation" style="color:#f8f8f2">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">OPTIONS:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--name value, -n value  the filename of auto complete script, default is </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl_autocomplete</span><span class="token punctuation" style="color:#f8f8f2">]</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>根据帮助说明得知，goctl completion 支持通过 --name 传递一个参数生成自动补全脚本文件名，但该参数为非必填，默认不填时为 goctl_autocomplete 文件，其位于 $GOCTLHOME 目录下。</p><ol start="2"><li>执行 goctl completion 来生成自动补全脚本</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl completion</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">generation auto completion success</span><span class="token operator" style="color:#ff79c6">!</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">executes the following script to setting shell:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">echo</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#ff79c6">PROG</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">goctl </span><span class="token builtin class-name" style="color:#bd93f9">source</span><span class="token plain"> /Users/keson/.goctl/.auto_complete/zsh/goctl_autocomplete </span><span class="token operator" style="color:#ff79c6">&gt;&gt;</span><span class="token plain"> ~/.zshrc </span><span class="token operator" style="color:#ff79c6">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#bd93f9">source</span><span class="token plain"> ~/.zshrc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">or</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">echo</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#ff79c6">PROG</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">goctl </span><span class="token builtin class-name" style="color:#bd93f9">source</span><span class="token plain"> /Users/keson/.goctl/.auto_complete/bash/goctl_autocomplete </span><span class="token operator" style="color:#ff79c6">&gt;&gt;</span><span class="token plain"> ~/.bashrc </span><span class="token operator" style="color:#ff79c6">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#bd93f9">source</span><span class="token plain"> ~/.bashrc</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><ol start="3"><li>查看当前 shell</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:#bd93f9">echo</span><span class="token plain"> </span><span class="token environment constant" style="color:#bd93f9">$SHELL</span><span class="token plain">                                                  </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">/bin/zsh</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><ol start="4"><li>选择对应 shell 的脚本执行，我这里为 zsh，所以执行指令如下</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:#bd93f9">echo</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#ff79c6">PROG</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">goctl </span><span class="token builtin class-name" style="color:#bd93f9">source</span><span class="token plain"> /Users/keson/.goctl/.auto_complete/zsh/goctl_autocomplete </span><span class="token operator" style="color:#ff79c6">&gt;&gt;</span><span class="token plain"> ~/.zshrc </span><span class="token operator" style="color:#ff79c6">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#bd93f9">source</span><span class="token plain"> ~/.zshrc</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><ol start="5"><li>重启终端验证结果</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># 键入 goctl 后按下 tab 键查看自动补全提示</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl </span><span class="token comment" style="color:#6272a4"># tab</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">api            -- generate api related files</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">bug            -- report a bug</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">completion     -- generation completion script, it only works </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> unix-like OS</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">docker</span><span class="token plain">         -- generate Dockerfile</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">env</span><span class="token plain">            -- check or edit goctl environment</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">help</span><span class="token plain">        h  -- Shows a list of commands or </span><span class="token builtin class-name" style="color:#bd93f9">help</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> one </span><span class="token builtin class-name" style="color:#bd93f9">command</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">kube           -- generate kubernetes files</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">migrate        -- migrate from tal-tech to zeromicro</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">model          -- generate model code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">rpc            -- generate rpc code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">template       -- template operation</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">upgrade        -- upgrade goctl to latest version</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="136"></a>1.3.6<a class="hash-link" href="#136" title="跳转到标题">#</a></h5><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>本节内容仅适合 goctl 版本在 1.3.6 及之后的的自动补全设置参考，1.3.6 之前的请跳过此节内容</p></div></div><ol><li>如果你是从 1.3.5 升级到 1.3.6 及以后，则需要执行如下指令来清除旧版本自动补全配置，这里以 zsh 为例子，否则请跳过这一步</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># 编辑 ~/.zshrc</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token function" style="color:#8be9fd">vim</span><span class="token plain"> ~/.zshrc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 找到 PROG=goctl 所在行并删除</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># source</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:#bd93f9">source</span><span class="token plain"> ~/.zshrc </span><span class="token operator" style="color:#ff79c6">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">rm</span><span class="token plain"> .zcompdump*</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 重启终端</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><ol start="2"><li>执行 goctl completion -h 查看使用说明，从使用帮助中可以查看到目前支持 bash、fish 、powershell、zsh 4 种 shell 的自动补全。</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl completion --help</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Generate the autocompletion script </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> goctl </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> the specified shell.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">See each sub-command&#x27;s </span><span class="token builtin class-name" style="color:#bd93f9">help</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> details on how to use the generated script.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Usage:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl completion </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">command</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Available Commands:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">bash</span><span class="token plain">        Generate the autocompletion script </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">bash</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">fish        Generate the autocompletion script </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> fish</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">powershell  Generate the autocompletion script </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> powershell</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">zsh</span><span class="token plain">         Generate the autocompletion script </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">zsh</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Flags:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-h, --help   </span><span class="token builtin class-name" style="color:#bd93f9">help</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> completion</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Use </span><span class="token string" style="color:#f1fa8c">&quot;goctl completion [command] --help&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">more</span><span class="token plain"> information about a command.</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><ol start="3"><li>查看当前使用的 shell</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:#bd93f9">echo</span><span class="token plain"> </span><span class="token environment constant" style="color:#bd93f9">$SHELL</span><span class="token plain">                                                  </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">/bin/zsh</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><ol start="4"><li>由于当前使用的 zsh，所以我们来看一下 zsh 的自动补全设置帮助</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl completion </span><span class="token function" style="color:#8be9fd">zsh</span><span class="token plain"> --help</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Generate the autocompletion script </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> the </span><span class="token function" style="color:#8be9fd">zsh</span><span class="token plain"> shell.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">If shell completion is not already enabled </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> your environment you will need</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">to </span><span class="token builtin class-name" style="color:#bd93f9">enable</span><span class="token plain"> it.  You can execute the following once:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token builtin class-name" style="color:#bd93f9">echo</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;autoload -U compinit; compinit&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&gt;&gt;</span><span class="token plain"> ~/.zshrc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">To load completions </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> every new session, execute once:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">#### Linux:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        goctl completion </span><span class="token function" style="color:#8be9fd">zsh</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;</span><span class="token string variable" style="color:#ff79c6">${fpath</span><span class="token string variable punctuation" style="color:#f8f8f2">[</span><span class="token string variable" style="color:#ff79c6">1</span><span class="token string variable punctuation" style="color:#f8f8f2">]</span><span class="token string variable" style="color:#ff79c6">}</span><span class="token string" style="color:#f1fa8c">/_goctl&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">#### macOS:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        goctl completion </span><span class="token function" style="color:#8be9fd">zsh</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&gt;</span><span class="token plain"> /usr/local/share/zsh/site-functions/_goctl</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">You will need to start a new shell </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> this setup to take effect.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Usage:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl completion </span><span class="token function" style="color:#8be9fd">zsh</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">flags</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Flags:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-h, --help              </span><span class="token builtin class-name" style="color:#bd93f9">help</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">zsh</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--no-descriptions   disable completion descriptions</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>从上文可以看出，根据操作系统的不同，自动补全的设置方式也不一样，我这里是 macOS，我们执行一下对应的指令：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl completion zsh &gt; /usr/local/share/zsh/site-functions/_goctl</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>我们先重开一个终端来试一下：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain"># 键入 goctl 后按下 tab 键查看自动补全提示</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl # tab</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">api         -- Generate api related files</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">bug         -- Report a bug</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">completion  -- Generate the autocompletion script for the specified shell</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">docker      -- Generate Dockerfile</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">env         -- Check or edit goctl environment</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">help        -- Help about any command</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">kube        -- Generate kubernetes files</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">migrate     -- Migrate from tal-tech to zeromicro</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">model       -- Generate model code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">quickstart  -- quickly start a project</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">rpc         -- Generate rpc code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">template    -- Template operation</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">upgrade     -- Upgrade goctl to latest version</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p><strong>常见错误</strong></p><ol><li>goctl Error: unknown flag: --generate-goctl-completion</li><li>(eval):1: command not found: _goctl
按照 1.3.6 自动补全配置重新行配置</li></ol><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="goctl-migrate"></a>goctl migrate<a class="hash-link" href="#goctl-migrate" title="跳转到标题">#</a></h4><p>帮助开发者从 1.3.0 之前版本无缝迁移到 1.3.0 及之后的任意版本，如果使用的 go-zero 版本本身就是 1.3.0 及之后的，则无需做此操作。</p><p><strong>为什么需要迁移？</strong>
go-zero 在 1.3.0 版本做了组织变更，即用 zeromicro 替换原来的 tal-tech 组织名称。</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>我现在有一个演示项目 awesomemigrate 是用旧版本 goctl 生成的，该项目的 go-zero 的 module 为</p></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">module awesomemigrate</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">go</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1.18</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">require github</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">com</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">tal</span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain">tech</span><span class="token operator" style="color:#ff79c6">/</span><span class="token keyword" style="color:#ff79c6">go</span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain">zero v1</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token number" style="color:#50fa7b">2.5</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token operator" style="color:#ff79c6">...</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>假设我们需要将该项目的 go-zero 升级至截止目前最新版本 1.3.3 ，要完成项目从 tal-tech 到 zeromicro 的升级前需要确保 goctl 版本大于 v1.3.2，然后在执行 goctl 迁移指令执行，如果 goctl 版本小于 v1.3.2，则需要升级。</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># 1. 查看当前 goctl 版本</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl --version</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl version </span><span class="token number" style="color:#50fa7b">1.2</span><span class="token plain">.5 darwin/amd64</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 2. 由于 goctl 版本小于 v1.3.2，则需要升级至最新，如果 goctl 版本已经是 1.3.2 及之后了，则可以不用升级</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ go </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> github.com/zeromicro/go-zero/tools/goctl@latest</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 3. 查看一下迁移指令使用帮助</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl migrate --help                                  </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">NAME:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl migrate - migrate from tal-tech to zeromicro</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">USAGE:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl migrate </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">command options</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">arguments</span><span class="token punctuation" style="color:#f8f8f2">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">DESCRIPTION:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">migrate is a transition </span><span class="token builtin class-name" style="color:#bd93f9">command</span><span class="token plain"> to </span><span class="token builtin class-name" style="color:#bd93f9">help</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">users</span><span class="token plain"> migrate their projects from tal-tech to zeromicro version</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">OPTIONS:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--verbose, -v    verbose enables extra logging</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--version value  the target release version of github.com/zeromicro/go-zero to migrate</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 4. 进入待迁移的项目下，执行迁移指令</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl migrate --version </span><span class="token number" style="color:#50fa7b">1.3</span><span class="token plain">.3</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 5. 验证依赖是否存在问题</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ go </span><span class="token builtin class-name" style="color:#bd93f9">test</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#bd93f9">.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">?       awesomemigrate  </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">no </span><span class="token builtin class-name" style="color:#bd93f9">test</span><span class="token plain"> files</span><span class="token punctuation" style="color:#f8f8f2">]</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>迁移完成后，我们再来看看 module 文件</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">module awesomemigrate</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">go</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1.18</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">require github</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">com</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">zeromicro</span><span class="token operator" style="color:#ff79c6">/</span><span class="token keyword" style="color:#ff79c6">go</span><span class="token operator" style="color:#ff79c6">-</span><span class="token plain">zero v1</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token number" style="color:#50fa7b">3.3</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token operator" style="color:#ff79c6">...</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>在 project 搜索一下 tal-tech 的匹配结果会发现为 0：</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="goctl-env"></a>goctl env<a class="hash-link" href="#goctl-env" title="跳转到标题">#</a></h4><p>goctl env 主要是用于环境检测、安装、环境参数控制等功能，除此之外还可以查看当前 goctl 的一些环境信息，以至于用户在遇到 bug 时可以根据此环境上报当前 goctl 处于的环境。</p><p>首先我们看看其使用说明</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"> --help                                    </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">NAME:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"> - check or edit goctl environment</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">USAGE:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#bd93f9">command</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">command options</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">arguments</span><span class="token punctuation" style="color:#f8f8f2">..</span><span class="token plain">.</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">COMMANDS:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#8be9fd">install</span><span class="token plain">  goctl </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"> installation</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">check    detect goctl </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"> and dependency tools</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">OPTIONS:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--write value, -w value  edit goctl environment</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--help, -h               show </span><span class="token builtin class-name" style="color:#bd93f9">help</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>goctl env 支持环境查看、参数修改、依赖检测安装几个功能，我们依次来看一下</p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1-环境查看"></a>1. 环境查看<a class="hash-link" href="#1-环境查看" title="跳转到标题">#</a></h5><p>在不输入任何 flag 的情况下，则是查看当前 goctl 环境。</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain">                                             </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#ff79c6">GOCTL_OS</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">darwin                        </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#ff79c6">GOCTL_ARCH</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">amd64</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#ff79c6">GOCTL_HOME</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">/Users/keson/.goctl</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#ff79c6">GOCTL_DEBUG</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">false</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#ff79c6">GOCTL_CACHE</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">/Users/keson/.goctl/cache</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#ff79c6">GOCTL_VERSION</span><span class="token operator" style="color:#ff79c6">=</span><span class="token number" style="color:#50fa7b">1.3</span><span class="token plain">.5</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#ff79c6">PROTOC_VERSION</span><span class="token operator" style="color:#ff79c6">=</span><span class="token number" style="color:#50fa7b">3.19</span><span class="token plain">.4</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#ff79c6">PROTOC_GEN_GO_VERSION</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">v1.27.1</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#ff79c6">PROTO_GEN_GO_GRPC_VERSION</span><span class="token operator" style="color:#ff79c6">=</span><span class="token number" style="color:#50fa7b">1.2</span><span class="token plain">.0</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>以上参数的大概说明为</p><table><thead><tr><th>参数名称</th><th>参数类型</th><th>参数说明</th></tr></thead><tbody><tr><td>GOCTL_OS</td><td>STRING</td><td>当前操作系统，常见值有 darwin、windows、linux 等</td></tr><tr><td>GOCTL_ARCH</td><td>STRING</td><td>当前系统架构，常见值有 amd64, 386 等</td></tr><tr><td>GOCTL_HOME</td><td>STRING</td><td>默认为 ~/.goctl</td></tr><tr><td>GOCTL_DEBUG</td><td>BOOLEAN</td><td>是否开启 debug 模式，默认为 false，目前暂未使用，主要是 goctl 开发中可能用于控制调试模式</td></tr><tr><td>GOCTL_CACHE</td><td>STRING</td><td>goctl 缓存目录，主要缓存下载的依赖 protoc、protoc-gen-go、protoc-gen-go-grpc 等</td></tr><tr><td>GOCTL_VERSION</td><td>STRING</td><td>当前 goctl 版本</td></tr><tr><td>PROTOC_VERSION</td><td>STRING</td><td>当前 protoc 版本，如未安装则为空字符串</td></tr><tr><td>PROTOC_GEN_GO_VERSION</td><td>STRING</td><td>当前 protoc-gen-go 版本，如未安装或者从 github.com/golang/protobuf 安装版本为 v1.3.2 之前的则为空字符串</td></tr><tr><td>PROTO_GEN_GO_GRPC_VERSION</td><td>STRING</td><td>当前 protoc-gen-go-grpc版本，如未安装则为空字符串</td></tr></tbody></table><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="2-修改参数"></a>2. 修改参数<a class="hash-link" href="#2-修改参数" title="跳转到标题">#</a></h5><p>比如我们将 GOCTL_DEBUG 修改为 true</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># 修改前</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">grep</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;GOCTL_DEBUG&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#ff79c6">GOCTL_DEBUG</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">false</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 修改 GOCTL_DEBUG 为 true</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"> -w </span><span class="token assign-left variable" style="color:#ff79c6">GOCTL_DEBUG</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">true</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 修改后</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">|</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">grep</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;GOCTL_DEBUG&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#ff79c6">GOCTL_DEBUG</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">true</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="3-依赖检测安装"></a>3. 依赖检测/安装<a class="hash-link" href="#3-依赖检测安装" title="跳转到标题">#</a></h5><p>我们来检测一下我当前的依赖都是否安装好，目前依赖检测内容为 protoc、protoc-gen-go、protoc-gen-go-grpc</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># 我们来检查一下依赖安装</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"> check --verbose                              </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: preparing to check </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: looking up </span><span class="token string" style="color:#f1fa8c">&quot;protoc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc&quot;</span><span class="token plain"> is not found </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> </span><span class="token environment constant" style="color:#bd93f9">PATH</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: looking up </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go&quot;</span><span class="token plain"> is not found </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> </span><span class="token environment constant" style="color:#bd93f9">PATH</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: looking up </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go-grpc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go-grpc&quot;</span><span class="token plain"> is not found </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> </span><span class="token environment constant" style="color:#bd93f9">PATH</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: check </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"> finish, some dependencies is not found </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> </span><span class="token environment constant" style="color:#bd93f9">PATH</span><span class="token plain">, you can execute</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">command</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;goctl env check --install&#x27;</span><span class="token plain"> to </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> it, </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> details, please execute </span><span class="token builtin class-name" style="color:#bd93f9">command</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token string" style="color:#f1fa8c">&#x27;goctl env check --help&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 安装依赖，安装依赖有 2 种方式</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 方式一</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># $ goctl env check --install --force --verbose</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 方式二</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> --verbose -f                       </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: preparing to check </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: looking up </span><span class="token string" style="color:#f1fa8c">&quot;protoc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc&quot;</span><span class="token plain"> is not found </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> </span><span class="token environment constant" style="color:#bd93f9">PATH</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: preparing to </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;protoc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc&quot;</span><span class="token plain"> is already installed </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;/Users/keson/go/bin/protoc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: looking up </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go&quot;</span><span class="token plain"> is not found </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> </span><span class="token environment constant" style="color:#bd93f9">PATH</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: preparing to </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go&quot;</span><span class="token plain"> is already installed </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;/Users/keson/go/bin/protoc-gen-go&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: looking up </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go-grpc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go-grpc&quot;</span><span class="token plain"> is not found </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> </span><span class="token environment constant" style="color:#bd93f9">PATH</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: preparing to </span><span class="token function" style="color:#8be9fd">install</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go-grpc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go-grpc&quot;</span><span class="token plain"> is already installed </span><span class="token keyword" style="color:#ff79c6">in</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;/Users/keson/go/bin/protoc-gen-go-grpc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: congratulations</span><span class="token operator" style="color:#ff79c6">!</span><span class="token plain"> your goctl environment is ready</span><span class="token operator" style="color:#ff79c6">!</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="goctl-rpc"></a>goctl rpc<a class="hash-link" href="#goctl-rpc" title="跳转到标题">#</a></h4><p>首先我们来看一下该指令的使用帮助</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl rpc -h                                                       </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Generate rpc code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Usage:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl rpc </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">flags</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl rpc </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">command</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Available Commands:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">new         Generate rpc demo </span><span class="token function" style="color:#8be9fd">service</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">protoc      Generate grpc code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">template    Generate proto template</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Flags:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--branch string   The branch of the remote repo, it does work with --remote</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-h, --help            </span><span class="token builtin class-name" style="color:#bd93f9">help</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> rpc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--home string     The goctl home path of the template, --home and --remote cannot be </span><span class="token builtin class-name" style="color:#bd93f9">set</span><span class="token plain"> at the same time, </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> they are, --remote has higher priority</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--o string        Output a sample proto </span><span class="token function" style="color:#8be9fd">file</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--remote string   The remote </span><span class="token function" style="color:#8be9fd">git</span><span class="token plain"> repo of the template, --home and --remote cannot be </span><span class="token builtin class-name" style="color:#bd93f9">set</span><span class="token plain"> at the same time, </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> they are, --remote has higher priority</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">The </span><span class="token function" style="color:#8be9fd">git</span><span class="token plain"> repo directory must be consistent with the https://github.com/zeromicro/go-zero-template directory structure</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Use </span><span class="token string" style="color:#f1fa8c">&quot;goctl rpc [command] --help&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">more</span><span class="token plain"> information about a command.</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>该指令提供了三个子指令，new 是快速创建一个 zrpc 服务，protoc 是根据 proto 描述文件生成 zrpc 代码，而 template 则是快速生成一个 proto 模板，我们将重点围绕 goctl rpc protoc 指令来展开，看看 goctl rpc protoc 的使用说明:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl rpc protoc -h                                              </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Generate grpc code</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Usage:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl rpc protoc </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">flags</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Examples:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl rpc protoc xx.proto --go_out</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">./pb --go-grpc_out</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">./pb --zrpc_out</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Flags:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--branch string     The branch of the remote repo, it does work with --remote</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-h, --help              </span><span class="token builtin class-name" style="color:#bd93f9">help</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> protoc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--home string       The goctl home path of the template, --home and --remote cannot be </span><span class="token builtin class-name" style="color:#bd93f9">set</span><span class="token plain"> at the same time, </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> they are, --remote has higher priority</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--remote string     The remote </span><span class="token function" style="color:#8be9fd">git</span><span class="token plain"> repo of the template, --home and --remote cannot be </span><span class="token builtin class-name" style="color:#bd93f9">set</span><span class="token plain"> at the same time, </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> they are, --remote has higher priority</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">The </span><span class="token function" style="color:#8be9fd">git</span><span class="token plain"> repo directory must be consistent with the https://github.com/zeromicro/go-zero-template directory structure</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--style string      The </span><span class="token function" style="color:#8be9fd">file</span><span class="token plain"> naming format, see </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">https://github.com/zeromicro/go-zero/tree/master/tools/goctl/config/readme.md</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">default </span><span class="token string" style="color:#f1fa8c">&quot;gozero&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-v, --verbose           Enable log output</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--zrpc_out string   The zrpc output directory</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>goctl rpc protoc 到底怎么使用，为什么示例里面有 --go_out、--go-grpc_out 参数，而查看 help 的时候却没有看到介绍？目前我们先这样理解，我们先抛开 goctl，根据官方 protoc 生成 grpc 代码时的指令是什么？会用到哪些 flag，对于 zrpc 的代码生成，你可以理解为 goctl 生成 zrpc 只是在生成 grpc 代码指令的基础上加了 goctl rpc 前缀和一些 goctl 生成 zrpc 需要的 flag，而对于 protoc 及插件 protoc-gen-go、 protoc-gen-grpc-go 的相关参数 goctl 只是做继承，没有必要显示的在 help 里面再描述一遍，后面在分析源码时可以给大家详细讲解一些这块的设计和考虑，接下来我们用一个例子来演示一下，假设我们有一个 greet.proto 文件，抛开 goctl ，我们生成 grpc 代码需要执行的指令如下：</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>如果不知道 grpc 代码是怎么生成的，这块建议参考官方文档 <a href="https://grpc.io/" target="_blank" rel="noopener noreferrer">https://grpc.io/</a></p></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># 进入 greet.proto 所在目录</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ protoc greet.proto --go_out </span><span class="token builtin class-name" style="color:#bd93f9">.</span><span class="token plain"> --go-grpc_out </span><span class="token builtin class-name" style="color:#bd93f9">.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ tree</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── greet.proto</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── pb</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── greet.pb.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── greet_grpc.pb.go</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>那么按照上文对 goctl rpc protoc 的介绍，我们生成 zrpc 代码的指令则应该为</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># 这里多了一个 --zrpc_out 用于指定 zrpc 代码的输出目录</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl rpc protoc greet.proto --go_out</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">. --go-grpc_out</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">. --zrpc_out</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">. --verbose                               </span><span class="token number" style="color:#50fa7b">23</span><span class="token plain">:02:39  羽2.625s</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: preparing to check </span><span class="token function" style="color:#8be9fd">env</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: looking up </span><span class="token string" style="color:#f1fa8c">&quot;protoc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc&quot;</span><span class="token plain"> is installed</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: looking up </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go&quot;</span><span class="token plain"> is installed</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: looking up </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go-grpc&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: </span><span class="token string" style="color:#f1fa8c">&quot;protoc-gen-go-grpc&quot;</span><span class="token plain"> is installed</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">goctl-env</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: congratulations</span><span class="token operator" style="color:#ff79c6">!</span><span class="token plain"> your goctl environment is ready</span><span class="token operator" style="color:#ff79c6">!</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">command</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">: protoc greet.proto --go_out </span><span class="token builtin class-name" style="color:#bd93f9">.</span><span class="token plain"> --go-grpc_out </span><span class="token builtin class-name" style="color:#bd93f9">.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Done.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ tree                                                                                                          </span><span class="token number" style="color:#50fa7b">23</span><span class="token plain">:02:52  羽819ms</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#bd93f9">.</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── etc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   └── greet.yaml</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── go.mod</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── greet</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   └── greet.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── greet.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── greet.proto</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── internal</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   ├── config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   └── config.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   ├── logic</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   └── pinglogic.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   ├── server</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   │   └── greetserver.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│   └── svc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">│       └── servicecontext.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── pb</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">├── greet.pb.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">└── greet_grpc.pb.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#50fa7b">8</span><span class="token plain"> directories, </span><span class="token number" style="color:#50fa7b">11</span><span class="token plain"> files</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>如果在生成代码时需要输出日志，可以加 --verbose 来显示日志。
goctl rpc protoc 在生成 zrpc 代码时会先对你的环境依赖进行检测，如果没有安装则会自动安装依赖再生成代码。</p></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="4-编辑器插件"></a>4. 编辑器插件<a class="hash-link" href="#4-编辑器插件" title="跳转到标题">#</a></h4><p>为了提升大家对 zero-api 文件的编写效率，我们分别对 intellij 和 vscode 提供了相应的编辑器插件, intellij 插件介绍及使用请参考 <a href="https://github.com/zeromicro/goctl-intellij%EF%BC%8C" target="_blank" rel="noopener noreferrer">https://github.com/zeromicro/goctl-intellij，</a> vscode 插件介绍及使用请参考 <a href="https://github.com/zeromicro/goctl-vscode/blob/main/README-cn.md" target="_blank" rel="noopener noreferrer">https://github.com/zeromicro/goctl-vscode/blob/main/README-cn.md</a></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="三goctl-使用中遇到的问题"></a>三、goctl 使用中遇到的问题<a class="hash-link" href="#三goctl-使用中遇到的问题" title="跳转到标题">#</a></h1><p>goctl 从最初的一个功能 rpc proxy 到当前版本(v1.3.5) 已经拥有 13 个一级指令和近 30 个二级指令, 期间 goctl 做了一些调整，而且，gcotl 本身的前进步伐也非常快，他更像是在摸索中前进，朝着更快，更好用的方向发展，因此在迭代的路上，goctl 会显得有些不稳定，大家兴许也遇到很多问题，这里大概总结一下大家在社区中反馈比较多的一些问题来分享一下。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1-386-架构上安装-goctl-失败"></a>1. 386 架构上安装 goctl 失败！<a class="hash-link" href="#1-386-架构上安装-goctl-失败" title="跳转到标题">#</a></h2><p>   描述：antlr 生成的源码中，没有对 386 架构的 uint 的边界值进行很好的处理，导致边界溢出
修复版本：<a href="https://github.com/zeromicro/go-zero/releases/tag/tools%2Fgoctl%2Fv1.3.3" target="_blank" rel="noopener noreferrer">v1.3.3</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="2-grpc-到底安装什么版本插件"></a>2. grpc 到底安装什么版本插件？<a class="hash-link" href="#2-grpc-到底安装什么版本插件" title="跳转到标题">#</a></h2><p>描述：熟悉 grpc 的人应该都知道，生成 grpc 代码的插件 protoc-gen-go 有两个仓库在维护，有 3 个安装来源，2 个维护仓库分别是：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># 1. golang</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># github.com/golang/protobuf/protoc-gen-go</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 2. protocolbuffers</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># github.com/protocolbuffers/protobuf-go/cmd/protoc-gen-go</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>3 个安装来源是</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><div tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#6272a4"># 1. golang 维护的仓库，目前已不推荐使用</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># github.com/golang/protobuf/protoc-gen-go</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 2. protocolbuffers 维护的，目前推荐使用的</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># github.com/protocolbuffers/protobuf-go/cmd/protoc-gen-go</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># 3. google 安装，这其实和第二种安装的是一个二进制，他的源码就是 protocolbuffers 维护的相同仓库</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4"># google.golang.org/protobuf/cmd/protoc-gen-go</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>在 v.1.3.4 前，如果使用 goctl rpc proto 生成 zrpc 代码则建议安装旧版本的插件,即 golang 维护的，因此该指令生成 zrpc 代码是 goctl 为了用户生成指令的简单，做了很厚的封装，但随之带来的问题就是难兼容，因此该指令已不推荐使用。</p><p>在 v.1.3.4 及以后，没有对 protoc-gen-go 做限制，用户可以自由选择不同的来源进行安装，但建议还是安装 protocolbuffer 维护的版本（官方文档已经替换为这个），而且必须要安装 protoc-gen-grpc-go 插件，这样做的目的是跟着 grpc 官方走，不过用户不用有太大的心理负担，一下安装这么多依赖，很麻烦，goctl 都已经帮你实现了，你只要使用 goctl rpc protoc 生成代码时会自动检测依赖并安装。</p><p>综上所述，建议大家还在使用该指令的用户尽早用 goctl rpc protoc 替代。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="3-为什么-windows-上生成-apizrpc-代码时总是提示-the-system-cannot-find-the-path-specified-类似错误"></a>3. 为什么 Windows 上生成 api/zrpc 代码时，总是提示 <code>The system cannot find the path specified</code> 类似错误？<a class="hash-link" href="#3-为什么-windows-上生成-apizrpc-代码时总是提示-the-system-cannot-find-the-path-specified-类似错误" title="跳转到标题">#</a></h2><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI text"><div tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">goctl.exe api go -api test.api -dir .</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Stat : The system cannot find the path specified.</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><p>描述：产生该原因是因为 <code>go list -json -m</code> 获取 go module 时拿到的是一个固定值 command-line-arguments，该问题已经在 <a href="https://github.com/zeromicro/go-zero/pull/1897" target="_blank" rel="noopener noreferrer">https://github.com/zeromicro/go-zero/pull/1897</a> 进行修复，版本将在 <code>v1.3.6</code> 生效。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="4-no-help-topic-proto"></a>4. No help topic &#x27;proto&#x27;<a class="hash-link" href="#4-no-help-topic-proto" title="跳转到标题">#</a></h2><p>描述：该指令在 <code>v1.3.4</code> 已经移除，用 <code>goctl rpc protoc</code> 替代</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="5-zrpc-生成代码时报-go_package-错误"></a>5. zrpc 生成代码时报 go_package 错误<a class="hash-link" href="#5-zrpc-生成代码时报-go_package-错误" title="跳转到标题">#</a></h2><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">protoc-gen-go: unable to determine Go import path for &quot;greet.proto&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Please specify either:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">• a &quot;go_package&quot; option in the .proto source file, or</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">• a &quot;M&quot; argument on the command line.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">See https://developers.google.com/protocol-buffers/docs/reference/go-generated#package for more information.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">--go_out: protoc-gen-go: Plugin failed with status code 1.</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="6-zrpc-生成代码时指定了-pb-的输出目录为当前服务-main-目录"></a>6. zrpc 生成代码时指定了 pb 的输出目录为当前服务 main 目录<a class="hash-link" href="#6-zrpc-生成代码时指定了-pb-的输出目录为当前服务-main-目录" title="跳转到标题">#</a></h2><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">the output of pb.go and _grpc.pb.go must not be the same with --zrpc_out:</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">pb output: /Users/keson/workspace/awesome-goctl/zwesome-zrpc/pb_in_main</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">zrpc out: /Users/keson/workspace/awesome-goctl/zwesome-zrpc/pb_in_main</span></div></div></div><button type="button" aria-label="代码复制" class="copyButton_M3SB">复制</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="7-为什么我的代码生成的-pb-client不带-client-标志"></a>7. 为什么我的代码生成的 pb client（不）带 client 标志？<a class="hash-link" href="#7-为什么我的代码生成的-pb-client不带-client-标志" title="跳转到标题">#</a></h2><p>这是旧版本 <code>goctl rpc proto</code> 生成 zrpc 代码时才有这个问题，目前已经移除了该指令。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="8-为什么我生成的目录结构和文档演示不一样"></a>8. 为什么我生成的目录结构和文档演示不一样？<a class="hash-link" href="#8-为什么我生成的目录结构和文档演示不一样" title="跳转到标题">#</a></h2><p>对于 <code>goctl rpc protoc</code> 生成 zrpc 代码的目录结构，总的结构上是不会存在差异的，唯一存在差异的是 pb 的输出目录，这个取决于你指定的参数来控制，控制 pb 输出目录的因素有 <code>go_opt</code>、<code>go-grpc_opt</code>、<code>go_package</code> ，详情可参考 《<a href="https://developers.google.com/protocol-buffers/docs/reference/go-generated" target="_blank" rel="noopener noreferrer">Protocol Buffers: Go Generated Code</a>》。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="9-为什么我安装了-goctl-编辑器插件还是不能高亮"></a>9. 为什么我安装了 goctl 编辑器插件还是不能高亮<a class="hash-link" href="#9-为什么我安装了-goctl-编辑器插件还是不能高亮" title="跳转到标题">#</a></h2><p>打开 Goland 的设置，搜索 FileTypes 设置 api 文件后缀即可。</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="扩展阅读"></a>扩展阅读<a class="hash-link" href="#扩展阅读" title="跳转到标题">#</a></h1><ol><li><a href="https://cobra.dev/" target="_blank" rel="noopener noreferrer">Cobra: A Framework for Modern CLI Apps in Go</a></li></ol></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/zeromicro/portal/edit/main/i18n/cn/docusaurus-plugin-content-docs/current/blog/share/goctl-share-part-one.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col text--right"><em><small>最后更新 日期： <time datetime="2023-05-19T10:46:18.000Z" class="lastUpdatedDate_nN9m">5/19/2023</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="文档页面导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cn/docs/blog/share/online-exchange"><div class="pagination-nav__sublabel">上一篇</div><div class="pagination-nav__label">« 10月3日线上交流问题汇总</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cn/docs/blog/share/goctl-share-part-two"><div class="pagination-nav__sublabel">下一篇</div><div class="pagination-nav__label">goctl 效能工具深度解析（二） »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-goctl-的诞生" class="table-of-contents__link">1. goctl 的诞生</a></li><li><a href="#2-为什么需要-goctl" class="table-of-contents__link">2. 为什么需要 goctl？</a></li><li><a href="#3-怎么理解开发规范" class="table-of-contents__link">3. 怎么理解开发规范？</a></li><li><a href="#4-怎么理解工程效率" class="table-of-contents__link">4. 怎么理解工程效率？</a></li><li><a href="#1-介绍" class="table-of-contents__link">1. 介绍</a></li><li><a href="#2-安装" class="table-of-contents__link">2. 安装</a><ul><li><a href="#go-getinstall" class="table-of-contents__link">go get/install</a></li><li><a href="#docker" class="table-of-contents__link">docker</a></li></ul></li><li><a href="#3-功能介绍" class="table-of-contents__link">3. 功能介绍</a><ul><li><a href="#重点演示" class="table-of-contents__link">重点演示</a></li></ul></li><li><a href="#1-386-架构上安装-goctl-失败" class="table-of-contents__link">1. 386 架构上安装 goctl 失败！</a></li><li><a href="#2-grpc-到底安装什么版本插件" class="table-of-contents__link">2. grpc 到底安装什么版本插件？</a></li><li><a href="#3-为什么-windows-上生成-apizrpc-代码时总是提示-the-system-cannot-find-the-path-specified-类似错误" class="table-of-contents__link">3. 为什么 Windows 上生成 api/zrpc 代码时，总是提示 <code>The system cannot find the path specified</code> 类似错误？</a></li><li><a href="#4-no-help-topic-proto" class="table-of-contents__link">4. No help topic &#39;proto&#39;</a></li><li><a href="#5-zrpc-生成代码时报-go_package-错误" class="table-of-contents__link">5. zrpc 生成代码时报 go_package 错误</a></li><li><a href="#6-zrpc-生成代码时指定了-pb-的输出目录为当前服务-main-目录" class="table-of-contents__link">6. zrpc 生成代码时指定了 pb 的输出目录为当前服务 main 目录</a></li><li><a href="#7-为什么我的代码生成的-pb-client不带-client-标志" class="table-of-contents__link">7. 为什么我的代码生成的 pb client（不）带 client 标志？</a></li><li><a href="#8-为什么我生成的目录结构和文档演示不一样" class="table-of-contents__link">8. 为什么我生成的目录结构和文档演示不一样？</a></li><li><a href="#9-为什么我安装了-goctl-编辑器插件还是不能高亮" class="table-of-contents__link">9. 为什么我安装了 goctl 编辑器插件还是不能高亮</a></li></ul></div></div></div></div></main></div></div><footer class="footer_rm3y section_bQ6r"><div class="footer__inner_OWoZ section--inner_6-fB"><div class="footer__column_+a5z footer__column--left_4bpB"><div><img alt="go-zero logo" class="footer__logo_ayM4" height="27" src="/cn/img/footer/go-zero.svg" title="go-zero" width="108"><img alt="stars" height="27" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="footer__logo_ayM4"><img alt="forks" height="27" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="footer__logo_ayM4"></div><p class="footer__tagline_b1u+">go-zero 是一个集成了各种工程实践的 web 和 rpc 框架</p><a class="footer__github_okz3 button_f7Ff button--icon_q89D button--secondary_x3vq button--xsmall_fwzy" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/cn/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_+a5z footer__column--right_FGdI"><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">zeromicro</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-api" rel="noopener noreferrer" target="_blank">zero-api</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-queue" rel="noopener noreferrer" target="_blank">go-queue</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/awesome-zero" rel="noopener noreferrer" target="_blank">awesome-zero</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-examples" rel="noopener noreferrer" target="_blank">zero-example</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">社区</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank">GitHub</a></li><li class="footer__item_K578"><span></span></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">友情链接</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://legacy.go-zero.dev" rel="noopener noreferrer" target="_blank">旧文档</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="/cn/docs/blog/blog">博客</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" rel="noopener noreferrer" target="_blank">开发路线图</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://landscape.cncf.io/?selected=go-zero" rel="noopener noreferrer" target="_blank">CNCF</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">微信二维码</li><li class="footer__item_K578"><div data-rmiz-wrap="visible"><img alt="微信群" width="80" src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/wechat.jpg" class="footer__img_4fbU"><button aria-label="Zoom image" data-rmiz-btn-open="true"></button></div></li></ul></div></div></div><div class="footer__bottom_rXtt"><p class="footer__copyright_9e29">Copyright © 2023 zeromicro</p><ul><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/portal/blob/main/LICENSE">License</a></li></ul><p></p></div></footer></div>
<script src="/cn/assets/js/main.70193b3d.js" defer="defer"></script>
</body>
</html>